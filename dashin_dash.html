<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>‡§¶‡§∂‡•à‡§Ç ‡§°‡•ç‡§Ø‡§æ‡§∏ | Dashain Dash</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet"/>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            height: 100%; 
            overscroll-behavior: none;
            touch-action: manipulation;
        }
        body {
            font-family: 'Noto Sans Devanagari', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            color: #333; 
            overflow-x: hidden;
            overflow-y: auto;
        }
        .header {
            background: rgba(0, 0, 0, 0.8); 
            padding: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .header a { 
            color: #ffd700; 
            font-size: clamp(16px, 4vw, 20px); 
            font-weight: 700; 
            text-decoration: none; 
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); 
        }
        .container { 
            width: 100%; 
            max-width: 1000px; 
            margin: 12px auto; 
            padding: 12px; 
            flex: 1;
        }
        .title { 
            text-align: center; 
            font-size: clamp(20px, 5vw, 28px); 
            font-weight: 700; 
            color: #fff; 
            padding: 10px 0; 
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); 
        }
        .instructions, .contact { 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 15px; 
            padding: 15px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            margin-bottom: 10px; 
        }
        .instructions h2 { 
            font-size: clamp(16px, 4vw, 20px); 
            color: #4a5568; 
            text-align: center; 
            margin-bottom: 8px; 
        }
        .instructions ul { 
            list-style: none; 
            color: #718096; 
            font-size: clamp(12px, 3vw, 14px); 
        }
        .instructions li { 
            margin-bottom: 6px; 
            padding-left: 18px; 
            position: relative; 
        }
        .instructions li::before { 
            content: 'üèÉ'; 
            position: absolute; 
            left: 0; 
            top: 0; 
        }
        .dashain-message { 
            background: linear-gradient(135deg, #ff6b6b, #ee5a24); 
            color: white; 
            text-align: center; 
            padding: 12px; 
            border-radius: 15px; 
            margin: 5px 0; 
            font-size: clamp(12px, 3vw, 14px); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 
            0%, 100% { transform: scale(1); } 
            50% { transform: scale(1.02); } 
        }

        .stats { 
            display: flex; 
            justify-content: space-between; 
            flex-wrap: wrap; 
            gap: 8px; 
            background: rgba(255, 255, 255, 0.95); 
            padding: 10px; 
            border-radius: 15px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
            margin-bottom: 10px; 
        }
        .stat { 
            padding: 6px 12px; 
            border-radius: 10px; 
            font-size: clamp(12px, 2.5vw, 16px); 
            font-weight: 600; 
            color: #2d3748; 
            background: rgba(255, 255, 255, 0.8); 
        }
        #high-score, #best-time { 
            background: rgba(255, 215, 0, 0.95); 
        }

        #fullscreen-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d); 
            border: none; 
            padding: 12px 24px; 
            border-radius: 25px; 
            color: white; 
            font-size: clamp(16px, 4vw, 20px); 
            font-weight: 700; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
            touch-action: manipulation;
            margin: 10px auto;
            display: block;
            z-index: 400;
        }
        #fullscreen-btn:hover {
            transform: translateY(-4px);
        }

        #exit-fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            padding: 8px 16px;
            border-radius: 25px;
            color: white;
            font-size: clamp(12px, 3vw, 16px);
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            touch-action: manipulation;
            z-index: 400;
            display: none;
        }
        #exit-fullscreen-btn:hover {
            transform: translateY(-4px);
        }

        #game-container {
            position: relative; 
            width: 100%; 
            height: clamp(500px, 80vh, 800px); 
            border-radius: 15px;
            background: linear-gradient(180deg, #87ceeb 0%, #98d8e8 80%, #4a8e4c 100%);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); 
            border: 4px solid #3b5998; 
            overflow: hidden;
            touch-action: none;
        }
        #game-area { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            touch-action: none; 
        }

        .arrow-controls {
            position: absolute;
            bottom: 40px;
            width: 100%;
            display: none;
            justify-content: space-between;
            z-index: 400;
        }
        .arrow-btn {
            width: clamp(100px, 30vw, 120px);
            height: clamp(100px, 30vw, 120px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(28px, 7vw, 36px);
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
            touch-action: manipulation;
        }
        #leftArrowBtn {
            position: absolute;
            left: 5px;
        }
        #rightArrowBtn {
            position: absolute;
            right: 5px;
        }
        .arrow-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .arrow-btn:hover {
            transform: translateY(-4px);
        }

        #game-over, #start-screen {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.55);
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 300;
        }
        #game-over { 
            display: none; 
            flex-direction: column; 
            color: white; 
            text-align: center; 
            gap: 8px; 
            padding: 20px; 
        }
        #game-over h2 { 
            font-size: clamp(24px, 6vw, 32px); 
            margin-bottom: 8px; 
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        #game-over p { 
            font-size: clamp(14px, 3.5vw, 18px); 
            opacity: 0.95; 
        }
        .play-btn, .restart-btn, .screenshot-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d); 
            border: none; 
            padding: 12px 24px; 
            border-radius: 25px; 
            color: white; 
            font-size: clamp(16px, 4vw, 20px); 
            font-weight: 700; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
            touch-action: manipulation;
            z-index: 400;
        }
        .play-btn:hover, .restart-btn:hover, .screenshot-btn:hover { 
            transform: translateY(-4px); 
        }

        .share-buttons { 
            display: flex; 
            gap: 8px; 
            margin-top: 8px; 
            flex-wrap: wrap; 
            justify-content: center; 
        }
        .share-btn { 
            padding: 10px 18px; 
            border-radius: 20px; 
            font-size: 14px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            color: white; 
            text-decoration: none; 
            z-index: 400;
        }
        .tiktok-btn { 
            background: linear-gradient(45deg, #ff0050, #ff4d6d); 
            box-shadow: 0 4px 15px rgba(255, 0, 80, 0.4); 
        }
        .facebook-btn { 
            background: linear-gradient(45deg, #3b5998, #4267b2); 
            box-shadow: 0 4px 15px rgba(59, 89, 152, 0.4); 
        }

        .player {
            position: absolute; 
            width: clamp(40px, 8vw, 60px); 
            height: clamp(40px, 8vw, 60px);
            background: url('player.png') no-repeat center/cover;
            bottom: 80px; 
            transition: left 0.18s ease; 
            z-index: 150; 
            user-select: none; 
            -webkit-user-select: none;
            border-radius: 8px;
            touch-action: none;
        }
        .obstacle {
            position: absolute; 
            width: clamp(30px, 6vw, 50px); 
            height: clamp(30px, 6vw, 50px);
            background: url('fruits_images/apple.png') no-repeat center/cover;
            top: -80px; 
            z-index: 100; 
            border-radius: 10px;
        }
        .item {
            position: absolute; 
            width: clamp(25px, 5vw, 40px); 
            height: clamp(25px, 5vw, 40px);
            background: url('fruits_images/coconut.png') no-repeat center/cover;
            top: -80px; 
            z-index: 120; 
            border-radius: 50%; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .splash {
            position: absolute; 
            width: 70px; 
            height: 24px; 
            background: radial-gradient(circle, rgba(255,255,255,0.75) 0%, rgba(255,255,255,0) 70%); 
            border-radius: 50%; 
            opacity: 0; 
            pointer-events: none; 
            animation: splashEffect 0.7s ease-out forwards; 
            z-index: 130;
        }
        @keyframes splashEffect { 
            0% { opacity: 0.7; transform: scale(0.5); } 
            100% { opacity: 0; transform: scale(1.5); } 
        }

        .footer { 
            text-align: center; 
            padding: 10px 0; 
            color: white; 
            font-size: clamp(10px, 2.5vw, 12px); 
        }
        .social-links { 
            display: flex; 
            justify-content: center; 
            gap: 12px; 
            margin-top: 8px; 
        }
        .social-link { 
            width: 35px; 
            height: 35px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-decoration: none; 
            color: white; 
            font-size: 18px; 
            transition: transform 0.3s ease; 
        }
        .tiktok-social { 
            background: linear-gradient(45deg, #ff0050, #ff4d6d); 
        }
        .facebook-social { 
            background: linear-gradient(45deg, #3b5998, #4267b2); 
        }

        @media (max-width: 768px) {
            .stats { 
                flex-direction: column; 
                align-items: center; 
            }
            .share-buttons { 
                flex-direction: column; 
                width: 80%; 
                margin: 0 auto; 
            }
            #game-container { 
                height: clamp(400px, 70vh, 600px); 
            }
            #game-container.fullscreen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100vh;
                border-radius: 0;
                border: none;
                margin: 0;
                padding: 0;
                z-index: 1000;
            }
            .fullscreen .header,
            .fullscreen .container > * {
                display: none;
            }
            .fullscreen .arrow-controls {
                display: flex;
            }
            .fullscreen #exit-fullscreen-btn {
                display: block;
            }
        }
        @media (max-width: 480px) {
            #game-container { 
                height: clamp(350px, 65vh, 500px); 
            }
            .player, .obstacle, .item {
                width: clamp(30px, 7vw, 50px);
                height: clamp(30px, 7vw, 50px);
            }
            .arrow-btn {
                width: clamp(60px, 15vw, 80px);
                height: clamp(60px, 15vw, 80px);
                font-size: clamp(24px, 6vw, 32px);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" target="_blank" rel="noopener">RSTECHZEN Game Zone</a>
    </div>

    <div class="container">
        <h1 class="title">‡§¶‡§∂‡•à‡§Ç ‡§°‡•ç‡§Ø‡§æ‡§∏</h1>

        <div class="dashain-message">üéâ ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç‡§ï‡•ã ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ! ‡§¶‡•å‡§°‡•á‡§∞ ‡§µ‡§∏‡•ç‡§§‡•Å‡§π‡§∞‡•Ç ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç! ü•≥</div>

        <div class="instructions">
            <h2>‡§ï‡§∏‡§∞‡•Ä ‡§ñ‡•á‡§≤‡•ç‡§®‡•á?</h2>
            <ul>
                <li>‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§® "‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç" ‡§¨‡§ü‡§® ‡§ü‡•ç‡§Ø‡§æ‡§™ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§¨‡§æ‡§Ø‡§æ‡§Å ‡§∞ ‡§¶‡§æ‡§Ø‡§æ‡§Å ‡§∏‡•ç‡§µ‡§æ‡§á‡§™ ‡§ó‡§∞‡•á‡§∞, ‚Üê ‡§∞ ‚Üí ‡§ï‡•Ä‡§π‡§∞‡•Ç ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•á‡§∞, ‡§µ‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§Æ‡§æ ‡§§‡§≤‡§ï‡§æ ‡§§‡•Ä‡§∞ ‡§¨‡§ü‡§®‡§π‡§∞‡•Ç ‡§ü‡•ç‡§Ø‡§æ‡§™ ‡§ó‡§∞‡•á‡§∞ ‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§≤‡§æ‡§à ‡§®‡§ø‡§Ø‡§®‡•ç‡§§‡•ç‡§∞‡§£ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§®‡§∞‡§ø‡§µ‡§≤ ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç, ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï‡§≤‡•á ‡•ß‡•¶ ‡§Ö‡§ô‡•ç‡§ï ‡§•‡§™‡§ø‡§®‡•ç‡§õ‡•§</li>
                <li>‡§¨‡§æ‡§ß‡§æ‡§π‡§∞‡•Ç‡§∏‡§Å‡§ó ‡§†‡•ã‡§ï‡•ç‡§ï‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡§≠‡§®‡•á ‡§ó‡§≤‡•ç‡§§‡•Ä ‡§ó‡§£‡§®‡§æ ‡§π‡•Å‡§®‡•ç‡§õ; ‡•´ ‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§®‡•ç‡§õ‡•§</li>
            </ul>
        </div>

        <div class="stats" aria-hidden="true">
            <div class="stat" id="score">‡§∏‡•ç‡§ï‡•ã‡§∞: ‡•¶</div>
            <div class="stat" id="mistakes">‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ‡•¶</div>
            <div class="stat" id="timer">‡§∏‡§Æ‡§Ø: ‡•¶:‡•¶‡•¶</div>
            <div class="stat" id="high-score">‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ‡•¶</div>
            <div class="stat" id="best-time">‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: --:--</div>
        </div>

        <button class="fullscreen-btn" id="fullscreen-btn">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®</button>

        <div id="game-container" aria-label="Game container">
            <div id="game-area" role="application" aria-label="Game area"></div>

            <div class="arrow-controls">
                <button class="arrow-btn" id="leftArrowBtn" aria-label="Move player left">‚Üê</button>
                <button class="arrow-btn" id="rightArrowBtn" aria-label="Move player right">‚Üí</button>
            </div>

            <div id="start-screen" aria-hidden="false">
                <button class="play-btn" id="playBtn">‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
            </div>

            <div id="game-over" aria-hidden="true">
                <h2>‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!</h2>
                <p>‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="final-score">‡•¶</span></p>
                <p>‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="final-high-score">‡•¶</span></p>
                <p>‡§ï‡•Å‡§≤ ‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: <span id="final-mistakes">‡•¶</span></p>
                <p>‡§∏‡§Æ‡§Ø: <span id="final-time">‡•¶:‡•¶‡•¶</span></p>
                <p>‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: <span id="final-best-time">--:--</span></p>
                <button class="restart-btn" id="restartBtn">‡§´‡•á‡§∞‡§ø ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <button class="screenshot-btn" id="screenshotBtn">‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <div class="share-buttons">
                    <a href="#" class="share-btn tiktok-btn" id="tiktokShare">üì± ‡§ü‡§ø‡§ï‡§ü‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                    <a href="#" class="share-btn facebook-btn" id="facebookShare">üìò ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                </div>
            </div>

            <button class="exit-fullscreen-btn" id="exit-fullscreen-btn">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§® ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
        </div>

        <div class="contact">
            <p>‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï: <a href="tel:9808942229">9808942229</a> | ‡§á‡§Æ‡•á‡§≤: <a href="mailto:rstechzen@gmail.com">rstechzen@gmail.com</a></p>
        </div>

        <div class="footer">
            <p>‡§µ‡§ø‡§ï‡§æ‡§∏‡§ï‡§∞‡•ç‡§§‡§æ: ‡§∞‡§∏‡•ç‡§ü‡•á‡§ï‡§ú‡•á‡§® | Social ID: @rstechzen | <a href="https://rstechzen.rf.gd/" target="_blank" rel="noopener">‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü</a></p>
            <p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§ü‡§ø‡§ï‡§ü‡§ï ‡§∞ ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§π‡§æ‡§Æ‡•Ä‡§≤‡§æ‡§à ‡§´‡§≤‡•ã ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!</p>
            <div class="social-links">
                <a href="https://www.facebook.com/rstechzen" class="social-link facebook-social" target="_blank" rel="noopener" aria-label="Facebook">f</a>
                <a href="https://www.tiktok.com/@rstechzen" class="social-link tiktok-social" target="_blank" rel="noopener" aria-label="TikTok">‚ô¨</a>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        /* ======== Elements & State ======== */
        const gameContainer = document.getElementById('game-container');
        const gameArea = document.getElementById('game-area');
        const startScreen = document.getElementById('start-screen');
        const playBtn = document.getElementById('playBtn');
        const restartBtn = document.getElementById('restartBtn');
        const screenshotBtn = document.getElementById('screenshotBtn');
        const leftArrowBtn = document.getElementById('leftArrowBtn');
        const rightArrowBtn = document.getElementById('rightArrowBtn');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const exitFullscreenBtn = document.getElementById('exit-fullscreen-btn');
        const scoreDisplay = document.getElementById('score');
        const mistakesDisplay = document.getElementById('mistakes');
        const timerDisplay = document.getElementById('timer');
        const highScoreDisplay = document.getElementById('high-score');
        const bestTimeDisplay = document.getElementById('best-time');
        const gameOverDisplay = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalHighScoreDisplay = document.getElementById('final-high-score');
        const finalMistakesDisplay = document.getElementById('final-mistakes');
        const finalTimeDisplay = document.getElementById('final-time');
        const finalBestTimeDisplay = document.getElementById('final-best-time');
        const tiktokShare = document.getElementById('tiktokShare');
        const facebookShare = document.getElementById('facebookShare');

        let score = 0, mistakes = 0, seconds = 0;
        let timerInterval = null, animationFrameId = null;
        let obstacles = [], items = [];
        let lastSpawnTime = 0;
        let gameActive = false;
        const maxMistakes = 5;

        let highScore = parseInt(localStorage.getItem('dashainDashHighScore') || '0', 10) || 0;
        let bestTime = parseInt(localStorage.getItem('dashainDashBestTime') || '0', 10) || 0;

        let playerEl = null;
        let lanes = [];
        let laneCount = 4;
        let currentLaneIndex = 0;

        highScoreDisplay.textContent = `‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ${highScore}`;
        bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${bestTime ? formatTime(bestTime) : '--:--'}`;

        /* ======== Utilities ======== */
        function formatTime(s) {
            const min = Math.floor(s / 60);
            const sec = s % 60;
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        function setHighScore(v) { localStorage.setItem('dashainDashHighScore', v); }
        function setBestTime(v) { localStorage.setItem('dashainDashBestTime', v); }

        /* ======== Full-Screen Handling ======== */
        function toggleFullScreen(e) {
            e.stopPropagation();
            if (!document.fullscreenElement) {
                gameContainer.requestFullscreen().then(() => {
                    gameContainer.classList.add('fullscreen');
                    fullscreenBtn.style.display = 'none';
                    exitFullscreenBtn.style.display = 'block';
                    if (screen.orientation && screen.orientation.lock) {
                        screen.orientation.lock('portrait').catch(err => {
                            console.warn('Orientation lock failed:', err);
                        });
                    }
                    computeLanes();
                    if (playerEl) playerEl.style.left = `${lanes[currentLaneIndex]}px`;
                }).catch(err => {
                    console.error('Fullscreen error:', err);
                    alert('‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§® ‡§Æ‡•ã‡§°‡§Æ‡§æ ‡§ú‡§æ‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡•á‡§∞‡§ø ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§');
                });
            } else {
                document.exitFullscreen().then(() => {
                    gameContainer.classList.remove('fullscreen');
                    fullscreenBtn.style.display = 'block';
                    exitFullscreenBtn.style.display = 'none';
                    if (screen.orientation && screen.orientation.unlock) {
                        screen.orientation.unlock();
                    }
                    computeLanes();
                    if (playerEl) playerEl.style.left = `${lanes[currentLaneIndex]}px`;
                }).catch(err => {
                    console.error('Exit fullscreen error:', err);
                    alert('‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§¨‡§æ‡§ü ‡§¨‡§æ‡§π‡§ø‡§∞ ‡§®‡§ø‡§∏‡•ç‡§ï‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡•á‡§∞‡§ø ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§');
                });
            }
        }

        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                gameContainer.classList.remove('fullscreen');
                fullscreenBtn.style.display = 'block';
                exitFullscreenBtn.style.display = 'none';
                if (screen.orientation && screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
            } else {
                gameContainer.classList.add('fullscreen');
                fullscreenBtn.style.display = 'none';
                exitFullscreenBtn.style.display = 'block';
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('portrait').catch(err => {
                        console.warn('Orientation lock failed:', err);
                    });
                }
            }
            computeLanes();
            if (playerEl) playerEl.style.left = `${lanes[currentLaneIndex]}px`;
            updateArrowButtonStates();
        });

        /* ======== Responsive lanes ======== */
        function computeLanes() {
            const areaRect = gameArea.getBoundingClientRect();
            const areaWidth = Math.max(200, areaRect.width);
            const approxLane = Math.floor(areaWidth / 120);
            laneCount = Math.min(6, Math.max(3, approxLane));
            const sampleW = playerEl ? playerEl.getBoundingClientRect().width : (areaWidth / laneCount) * 0.6;
            lanes = [];
            const laneWidth = areaWidth / laneCount;
            for (let i = 0; i < laneCount; i++) {
                const left = Math.round(i * laneWidth + (laneWidth - sampleW) / 2);
                lanes.push(left);
            }
            currentLaneIndex = Math.min(currentLaneIndex, laneCount - 1);
        }

        /* ======== Create / remove entities ======== */
        function createPlayer() {
            if (playerEl) playerEl.remove();
            playerEl = document.createElement('div');
            playerEl.className = 'player';
            playerEl.setAttribute('aria-label', 'player');
            gameArea.appendChild(playerEl);
            computeLanes();
            currentLaneIndex = Math.floor(laneCount / 2);
            playerEl.style.left = `${lanes[currentLaneIndex]}px`;
        }

        function createObstacle() {
            if (!gameArea) return;
            const obs = document.createElement('div');
            obs.className = 'obstacle';
            const chosenLane = lanes[Math.floor(Math.random() * lanes.length)];
            obs.style.left = `${chosenLane}px`;
            obs.style.top = `-100px`;
            gameArea.appendChild(obs);
            obstacles.push({ el: obs, x: chosenLane, y: -100 });
        }

        function createItem() {
            if (!gameArea) return;
            const it = document.createElement('div');
            it.className = 'item';
            const chosenLane = lanes[Math.floor(Math.random() * lanes.length)];
            it.style.left = `${chosenLane}px`;
            it.style.top = `-120px`;
            gameArea.appendChild(it);
            items.push({ el: it, x: chosenLane, y: -120 });
        }

        function createSplash(x, y) {
            const splash = document.createElement('div');
            splash.className = 'splash';
            splash.style.left = `${x - 35}px`;
            splash.style.top = `${y - 10}px`;
            gameArea.appendChild(splash);
            setTimeout(() => splash.remove(), 800);
        }

        /* ======== Movement by lane index ======== */
        function movePlayerDir(dir) {
            if (!gameActive || !playerEl) return;
            if (dir === 'left' && currentLaneIndex > 0) currentLaneIndex--;
            else if (dir === 'right' && currentLaneIndex < laneCount - 1) currentLaneIndex++;
            playerEl.style.left = `${lanes[currentLaneIndex]}px`;
            updateArrowButtonStates();
        }

        /* ======== Update arrow button states ======== */
        function updateArrowButtonStates() {
            leftArrowBtn.disabled = !gameActive || currentLaneIndex <= 0;
            rightArrowBtn.disabled = !gameActive || currentLaneIndex >= laneCount - 1;
        }

        /* ======== Collisions ======== */
        function checkCollisions() {
            if (!playerEl) return;
            const playerRect = playerEl.getBoundingClientRect();
            obstacles = obstacles.filter(o => {
                if (!o.el) return false;
                const r = o.el.getBoundingClientRect();
                const hit = !(playerRect.right < r.left || playerRect.left > r.right || playerRect.bottom < r.top || playerRect.top > r.bottom);
                if (hit && gameActive) {
                    mistakes += 1;
                    mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
                    createSplash(playerRect.left + playerRect.width / 2, playerRect.top + playerRect.height / 2);
                    o.el.remove();
                    return false;
                }
                return true;
            });
            items = items.filter(i => {
                if (!i.el) return false;
                const r = i.el.getBoundingClientRect();
                const hit = !(playerRect.right < r.left || playerRect.left > r.right || playerRect.bottom < r.top || playerRect.top > r.bottom);
                if (hit && gameActive) {
                    score += 10;
                    scoreDisplay.textContent = `‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`;
                    createSplash(r.left + r.width / 2, r.top + r.height / 2);
                    i.el.remove();
                    return false;
                }
                return true;
            });
            if (mistakes >= maxMistakes) endGame();
        }

        /* ======== Game loop ======== */
        function gameLoop(timestamp) {
            if (!gameActive) return;
            const areaRect = gameArea.getBoundingClientRect();
            const baseSpeed = 2.5;
            const speed = baseSpeed + Math.min(score / 100, 6);

            obstacles.forEach(o => {
                o.y += speed;
                if (o.el) o.el.style.top = `${o.y}px`;
            });
            obstacles = obstacles.filter(o => {
                if (o.y > areaRect.height + 200) { o.el && o.el.remove(); return false; }
                return true;
            });

            items.forEach(i => {
                i.y += speed;
                if (i.el) i.el.style.top = `${i.y}px`;
            });
            items = items.filter(i => {
                if (i.y > areaRect.height + 200) { i.el && i.el.remove(); return false; }
                return true;
            });

            const spawnInterval = Math.max(350, 1400 - score * 8);
            if (timestamp - lastSpawnTime > spawnInterval) {
                if (Math.random() < 0.75) createObstacle();
                if (Math.random() < 0.55) createItem();
                lastSpawnTime = timestamp;
            }

            checkCollisions();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        /* ======== Timer ======== */
        function startTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
            timerInterval = setInterval(() => {
                if (gameActive) {
                    seconds += 1;
                    timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
                }
            }, 1000);
        }

        /* ======== Start / End / Restart ======== */
        function startGame() {
            startScreen.style.display = 'none';
            gameOverDisplay.style.display = 'none';
            gameArea.innerHTML = '';
            score = 0; mistakes = 0;
            scoreDisplay.textContent = `‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`;
            mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
            gameActive = true;
            obstacles = []; items = [];
            createPlayer();
            computeLanes();
            lastSpawnTime = performance.now();
            startTimer();
            animationFrameId = requestAnimationFrame(gameLoop);
            updateArrowButtonStates();
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            cancelAnimationFrame(animationFrameId);

            if (score > highScore) {
                highScore = score;
                highScoreDisplay.textContent = `‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ${highScore}`;
                setHighScore(highScore);
            }
            if (!bestTime || seconds > bestTime) {
                bestTime = seconds;
                bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${formatTime(bestTime)}`;
                setBestTime(bestTime);
            }

            finalScoreDisplay.textContent = score;
            finalHighScoreDisplay.textContent = highScore;
            finalMistakesDisplay.textContent = mistakes;
            finalTimeDisplay.textContent = formatTime(seconds);
            finalBestTimeDisplay.textContent = bestTime ? formatTime(bestTime) : '--:--';

            gameOverDisplay.style.display = 'flex';
            startScreen.style.display = 'none';

            obstacles.forEach(o => o.el && o.el.remove());
            items.forEach(i => i.el && i.el.remove());
            obstacles = []; items = [];
            playerEl && playerEl.remove();
            playerEl = null;
            updateArrowButtonStates();
        }

        function restartGame() {
            gameOverDisplay.style.display = 'none';
            startScreen.style.display = 'flex';
            gameActive = false;
            clearInterval(timerInterval);
            cancelAnimationFrame(animationFrameId);
            gameArea.innerHTML = '';
            obstacles = []; items = [];
            updateArrowButtonStates();
        }

        /* ======== Screenshot & Sharing ======== */
        function takeScreenshot() {
            if (typeof html2canvas === 'undefined') {
                alert('Screenshot library not yet loaded. Try again in a moment.');
                return;
            }
            html2canvas(gameContainer).then(canvas => {
                const link = document.createElement('a');
                link.download = `‡§¶‡§∂‡•à‡§Ç_‡§°‡•ç‡§Ø‡§æ‡§∏_‡§∏‡•ç‡§ï‡•ã‡§∞_${score}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }).catch(err => {
                console.error(err);
                alert('‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§® ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§≠‡§Ø‡•ã‡•§ ‡§ï‡§®‡•ç‡§∏‡•ã‡§≤ ‡§π‡•á‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§');
            });
        }

        function shareToTikTok(e) {
            e.preventDefault();
            if (navigator.share) {
                navigator.share({
                    title: `‡§¶‡§∂‡•à‡§Ç ‡§°‡•ç‡§Ø‡§æ‡§∏ - ‡§∏‡•ç‡§ï‡•ã‡§∞ ${score}!`,
                    text: `‡§Æ‡•à‡§≤‡•á ‡§¶‡§∂‡•à‡§Ç ‡§°‡•ç‡§Ø‡§æ‡§∏‡§Æ‡§æ ${score} ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§∞ ${formatTime(seconds)} ‡§∏‡§Æ‡§Ø‡§Æ‡§æ ‡§ñ‡•á‡§≤‡•á‡§Ç! ‡§§‡§™‡§æ‡§à‡§Ç ‡§™‡§®‡§ø ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç üéÆ`,
                    url: window.location.href
                }).catch(console.error);
            } else {
                const text = `‡§¶‡§∂‡•à‡§Ç ‡§°‡•ç‡§Ø‡§æ‡§∏ - ‡§∏‡•ç‡§ï‡•ã‡§∞ ${score}! ‡§∏‡§Æ‡§Ø ${formatTime(seconds)}! ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç! üéâ\n${window.location.href}`;
                navigator.clipboard.writeText(text).then(() => alert('‡§ü‡§ø‡§ï‡§ü‡§ï‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø ‡§≤‡§ø‡§ô‡•ç‡§ï ‡§ï‡§™‡•Ä ‡§≠‡§Ø‡•ã! ‡§™‡•á‡§∏‡•ç‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§')).catch(() => alert('‡§ï‡§™‡•Ä ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§'));
            }
        }

        function shareToFacebook(e) {
            e.preventDefault();
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent('‡§Æ‡•à‡§≤‡•á ‡§¶‡§∂‡•à‡§Ç ‡§°‡•ç‡§Ø‡§æ‡§∏‡§Æ‡§æ ' + score + ' ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§∞ ' + formatTime(seconds) + ' ‡§∏‡§Æ‡§Ø‡§Æ‡§æ ‡§ñ‡•á‡§≤‡•á‡§Ç! ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç! üéâ')}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        /* ======== Input handlers ======== */
        playBtn.addEventListener('click', startGame, { passive: false });
        playBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startGame();
        }, { passive: false });
        restartBtn.addEventListener('click', () => { restartGame(); startGame(); }, { passive: false });
        restartBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            restartGame();
            startGame();
        }, { passive: false });
        screenshotBtn.addEventListener('click', takeScreenshot, { passive: false });
        screenshotBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            takeScreenshot();
        }, { passive: false });
        tiktokShare.addEventListener('click', shareToTikTok, { passive: false });
        tiktokShare.addEventListener('touchstart', shareToTikTok, { passive: false });
        facebookShare.addEventListener('click', shareToFacebook, { passive: false });
        facebookShare.addEventListener('touchstart', shareToFacebook, { passive: false });
        leftArrowBtn.addEventListener('click', () => movePlayerDir('left'), { passive: false });
        leftArrowBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            movePlayerDir('left');
        }, { passive: false });
        rightArrowBtn.addEventListener('click', () => movePlayerDir('right'), { passive: false });
        rightArrowBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            movePlayerDir('right');
        }, { passive: false });
        fullscreenBtn.addEventListener('click', toggleFullScreen, { passive: false });
        fullscreenBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            e.stopPropagation();
            toggleFullScreen(e);
        }, { passive: false });
        exitFullscreenBtn.addEventListener('click', toggleFullScreen, { passive: false });
        exitFullscreenBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            e.stopPropagation();
            toggleFullScreen(e);
        }, { passive: false });

        document.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            if (e.key === 'ArrowLeft') movePlayerDir('left');
            if (e.key === 'ArrowRight') movePlayerDir('right');
        });

        // Touch swipe handler (left/right)
        let touchStartX = null;
        gameArea.addEventListener('touchstart', (e) => {
            if (!gameActive) return;
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
        }, { passive: false });

        gameArea.addEventListener('touchmove', (e) => {
            if (!gameActive || touchStartX === null) return;
            e.preventDefault();
        }, { passive: false });

        gameArea.addEventListener('touchend', (e) => {
            if (!gameActive || touchStartX === null) return;
            e.preventDefault();
            const touchEndX = (e.changedTouches && e.changedTouches[0] && e.changedTouches[0].clientX) || touchStartX;
            const delta = touchEndX - touchStartX;
            if (Math.abs(delta) > 30) movePlayerDir(delta < 0 ? 'left' : 'right');
            touchStartX = null;
        }, { passive: false });

        // Prevent page scrolling while touching game container
        gameContainer.addEventListener('touchstart', (e) => {
            if (e.target.classList.contains('play-btn') || 
                e.target.classList.contains('restart-btn') || 
                e.target.classList.contains('screenshot-btn') || 
                e.target.classList.contains('share-btn') || 
                e.target.classList.contains('arrow-btn') || 
                e.target.classList.contains('fullscreen-btn') || 
                e.target.classList.contains('exit-fullscreen-btn')) return;
            e.preventDefault();
        }, { passive: false });

        // Resize: recompute lanes so game fills width
        let resizeTimeout = null;
        window.addEventListener('resize', () => {
            if (resizeTimeout) clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (playerEl) {
                    computeLanes();
                    playerEl.style.left = `${lanes[currentLaneIndex]}px`;
                    updateArrowButtonStates();
                }
            }, 120);
        });

        // Init UI state on load
        document.addEventListener('DOMContentLoaded', () => {
            startScreen.style.display = 'flex';
            gameOverDisplay.style.display = 'none';
            scoreDisplay.textContent = `‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`;
            mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
            timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
            highScoreDisplay.textContent = `‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ${highScore}`;
            bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${bestTime ? formatTime(bestTime) : '--:--'}`;
            fullscreenBtn.style.display = 'block';
            exitFullscreenBtn.style.display = 'none';
            updateArrowButtonStates();
        });

        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            gameActive = false;
            clearInterval(timerInterval);
            cancelAnimationFrame(animationFrameId);
        });
    </script>
</body>
</html>


