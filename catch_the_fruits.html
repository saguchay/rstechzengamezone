<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>‡§´‡§≤ ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•á ‡§ñ‡•á‡§≤ | Catch the Fruit</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        html, body { 
            height: 100%; 
            overscroll-behavior: none;
            touch-action: manipulation;
        }
        body {
            font-family: 'Noto Sans Devanagari', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            color: #333; 
            overflow-x: hidden;
            overflow-y: auto;
        }
        .header {
            background: rgba(0,0,0,0.8); 
            padding: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .header a { 
            color: #ffd700; 
            font-size: clamp(16px, 4vw, 20px); 
            font-weight: 700; 
            text-decoration: none; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.5); 
        }
        .container { 
            width: 100%; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 12px; 
            flex: 1;
        }
        .title { 
            text-align: center; 
            font-size: clamp(20px, 5vw, 28px); 
            font-weight: 700; 
            color: #fff; 
            padding: 10px 0; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.3); 
        }
        .instructions, .contact { 
            background: rgba(255,255,255,0.95); 
            border-radius: 15px; 
            padding: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255,255,255,0.2); 
            margin-bottom: 10px; 
        }
        .instructions h2 { 
            font-size: clamp(16px, 4vw, 20px); 
            color: #4a5568; 
            text-align: center; 
            margin-bottom: 8px; 
        }
        .instructions ul { 
            list-style: none; 
            color: #718096; 
            font-size: clamp(12px, 3vw, 14px); 
        }
        .instructions li { 
            margin-bottom: 6px; 
            padding-left: 18px; 
            position: relative; 
        }
        .instructions li::before { 
            content: 'üçé'; 
            position: absolute; 
            left: 0; 
            top: 0; 
        }
        .dashain-message { 
            background: linear-gradient(135deg, #ff6b6b, #ee5a24); 
            color: white; 
            text-align: center; 
            padding: 12px; 
            border-radius: 15px; 
            margin: 5px 0; 
            font-size: clamp(12px, 3vw, 14px); 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 
            0%, 100% { transform: scale(1); } 
            50% { transform: scale(1.02); } 
        }

        #game-container {
            position: relative; 
            width: 100%; 
            height: clamp(420px, 60vh, 640px); 
            border-radius: 15px;
            background: linear-gradient(180deg, #87ceeb 0%, #98d8e8 80%, #4a8e4c 100%);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); 
            border: 4px solid #3b5998; 
            overflow: hidden;
            touch-action: none;
        }
        #game-area { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
        }

        .stats { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            right: 10px; 
            display: flex; 
            justify-content: space-between; 
            z-index: 200; 
        }
        .stat { 
            background: rgba(255,255,255,0.95); 
            padding: 6px 12px; 
            border-radius: 15px; 
            font-size: clamp(12px, 2.5vw, 16px); 
            font-weight: 600; 
            color: #2d3748; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
        }
        #high-score { 
            background: rgba(255,215,0,0.95); 
        }

        #game-over, #start-screen {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.7);
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 300;
        }
        #game-over { 
            display: none; 
            flex-direction: column; 
            color: white; 
            text-align: center; 
            gap: 8px; 
        }
        #game-over h2 { 
            font-size: clamp(24px, 6vw, 32px); 
            margin-bottom: 8px; 
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        #game-over p { 
            font-size: clamp(14px, 3.5vw, 18px); 
            opacity: 0.95; 
        }
        .play-btn, .restart-btn, .screenshot-btn, .fullscreen-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d); 
            border: none; 
            padding: 12px 24px; 
            border-radius: 25px; 
            color: white; 
            font-size: clamp(16px, 4vw, 20px); 
            font-weight: 700; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(78,205,196,0.4);
            touch-action: manipulation;
        }
        .play-btn:hover, .restart-btn:hover, .screenshot-btn:hover, .fullscreen-btn:hover { 
            transform: translateY(-4px); 
        }

        .share-buttons { 
            display: flex; 
            gap: 8px; 
            margin-top: 8px; 
        }
        .share-btn { 
            padding: 10px 18px; 
            border-radius: 20px; 
            font-size: 14px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            color: white; 
            text-decoration: none; 
        }
        .tiktok-btn { 
            background: linear-gradient(45deg, #ff0050, #ff4d6d); 
            box-shadow: 0 4px 15px rgba(255,0,80,0.4); 
        }
        .facebook-btn { 
            background: linear-gradient(45deg, #3b5998, #4267b2); 
            box-shadow: 0 4px 15px rgba(59,89,152,0.4); 
        }

        .item {
            position: absolute; 
            width: clamp(35px, 7vw, 60px); 
            height: clamp(35px, 7vw, 60px); 
            background-size: cover; 
            background-position: center; 
            cursor: pointer; 
            border-radius: 50%; 
            transition: transform 0.08s ease; 
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
            z-index: 150; 
            user-select: none; 
            -webkit-user-select: none; 
            touch-action: none;
        }
        .item:active { 
            transform: scale(0.96); 
        }
        .apple { background-image: url('fruits_images/apple.png'); }
        .mango { background-image: url('fruits_images/mango.png'); }
        .banana { background-image: url('fruits_images/banana.png'); }
        .strawberry { background-image: url('fruits_images/strawberry.png'); }
        .grapes { background-image: url('fruits_images/grapes.png'); }
        .blueberry { background-image: url('fruits_images/blueberry.png'); }

        .splash {
            position: absolute; 
            width: 70px; 
            height: 24px; 
            background: radial-gradient(circle, rgba(255,255,255,0.75) 0%, rgba(255,255,255,0) 70%); 
            border-radius: 50%; 
            opacity: 0; 
            pointer-events: none; 
            animation: splashEffect 0.7s ease-out forwards; 
            z-index: 120;
        }
        @keyframes splashEffect { 
            0% { opacity: 0.7; transform: scale(0.5); } 
            100% { opacity: 0; transform: scale(1.5); } 
        }

        .footer { 
            text-align: center; 
            padding: 10px 0; 
            color: white; 
            font-size: clamp(10px, 2.5vw, 12px); 
        }
        .social-links { 
            display: flex; 
            justify-content: center; 
            gap: 12px; 
            margin-top: 8px; 
        }
        .social-link { 
            width: 35px; 
            height: 35px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-decoration: none; 
            color: white; 
            font-size: 18px; 
            transition: transform 0.3s ease; 
        }
        .tiktok-social { 
            background: linear-gradient(45deg, #ff0050, #ff4d6d); 
        }
        .facebook-social { 
            background: linear-gradient(45deg, #3b5998, #4267b2); 
        }
        #fullscreen-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            z-index: 200;
            padding: 8px 16px;
            font-size: clamp(12px, 3vw, 16px);
        }
        @media (max-width: 768px) {
            .stats { 
                flex-direction: column; 
                gap: 8px; 
                align-items: center; 
            }
            .share-buttons { 
                flex-direction: column; 
                width: 80%; 
                margin: 0 auto; 
            }
            #game-container {
                height: clamp(360px, 50vh, 480px);
            }
            #game-container.fullscreen {
                height: 100vh;
                border-radius: 0;
                border: none;
                margin: 0;
                padding: 0;
            }
            .fullscreen #fullscreen-btn {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" target="_blank" rel="noopener">RSTECHZEN Game Zone</a>
    </div>

    <div class="container">
        <div class="dashain-message">üéâ ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç‡§ï‡•ã ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ! ‡§´‡§≤‡§π‡§∞‡•Ç ‡§∏‡§Æ‡§æ‡§§‡•á‡§∞ ‡§Ü‡§®‡§®‡•ç‡§¶ ‡§≤‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç! ü•≥</div>

        <div class="instructions">
            <h2>‡§ï‡§∏‡§∞‡•Ä ‡§ñ‡•á‡§≤‡•ç‡§®‡•á?</h2>
            <ul>
                <li>‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§® "‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç" ‡§¨‡§ü‡§® ‡§•‡§ø‡§ö‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§´‡§≤‡§π‡§∞‡•Ç (‡§∏‡•ç‡§Ø‡§æ‡§â, ‡§Ü‡§Å‡§™, ‡§ï‡•á‡§∞‡§æ, ‡§∏‡•ç‡§ü‡•ç‡§∞‡§¨‡•á‡§∞‡•Ä, ‡§Ö‡§ô‡•ç‡§ó‡•Å‡§∞, ‡§¨‡•ç‡§≤‡•Ç‡§¨‡•á‡§∞‡•Ä) ‡§Æ‡§æ ‡§ü‡•ç‡§Ø‡§æ‡§™ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç - ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï‡§≤‡•á ‡•ß ‡§Ö‡§ô‡•ç‡§ï ‡§•‡§™‡§ø‡§®‡•ç‡§õ‡•§</li>
                <li>‡•®‡•¶ ‡§µ‡§ü‡§æ ‡§´‡§≤‡§π‡§∞‡•Ç ‡§ó‡•Å‡§Æ‡§æ‡§â‡§®‡•Å ‡§≠‡§Ø‡•ã ‡§≠‡§®‡•á ‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§®‡•ç‡§õ‡•§</li>
                <li>‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§¨‡§¢‡•ç‡§¶‡•à ‡§ú‡§æ‡§Å‡§¶‡§æ ‡§´‡§≤‡§π‡§∞‡•Ç ‡§õ‡§ø‡§ü‡•ã ‡§ù‡§∞‡•ç‡§õ‡§®‡•ç!</li>
            </ul>
        </div>

        <div id="game-container">
            <div id="game-area"></div>

            <div id="start-screen">
                <button class="play-btn" id="playBtn">‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
            </div>

            <div class="stats">
                <div class="stat" id="score">‡§∏‡•ç‡§ï‡•ã‡§∞: ‡•¶</div>
                <div class="stat" id="misses">‡§ó‡•Å‡§Æ‡§æ‡§è‡§ï‡§æ: ‡•¶</div>
                <div class="stat" id="high-score">‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ‡•¶</div>
            </div>

            <div id="game-over">
                <h2>‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!</h2>
                <p>‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="final-score">‡•¶</span></p>
                <p>‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="final-high-score">‡•¶</span></p>
                <button class="restart-btn" id="restartBtn">‡§´‡•á‡§∞‡§ø ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <button class="screenshot-btn" id="screenshotBtn">‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <div class="share-buttons">
                    <a href="#" class="share-btn tiktok-btn" id="tiktokShare">üì± ‡§ü‡§ø‡§ï‡§ü‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                    <a href="#" class="share-btn facebook-btn" id="facebookShare">üìò ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                </div>
            </div>

            <button class="fullscreen-btn" id="fullscreenBtn">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®</button>
        </div>

        <h1 class="title">‡§´‡§≤ ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•á ‡§ñ‡•á‡§≤</h1>

        <div class="contact">
            <p>‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï: <a href="tel:9808942229">9808942229</a> | ‡§á‡§Æ‡•á‡§≤: <a href="mailto:rstechzen@gmail.com">rstechzen@gmail.com</a></p>
        </div>

        <div class="footer">
            <p>‡§µ‡§ø‡§ï‡§æ‡§∏‡§ï‡§∞‡•ç‡§§‡§æ: ‡§∞‡§∏‡•ç‡§ü‡•á‡§ï‡§ú‡•á‡§® | Social ID: @rstechzen | <a href="https://rstechzen.rf.gd/" target="_blank" rel="noopener">‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü</a></p>
            <p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§ü‡§ø‡§ï‡§ü‡§ï ‡§∞ ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§π‡§æ‡§Æ‡•Ä‡§≤‡§æ‡§à ‡§´‡§≤‡•ã ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!</p>
            <div class="social-links">
                <a href="https://www.facebook.com/rstechzen" class="social-link facebook-social" target="_blank" rel="noopener" aria-label="Facebook">f</a>
                <a href="https://www.tiktok.com/@rstechzen" class="social-link tiktok-social" target="_blank" rel="noopener" aria-label="TikTok">‚ô¨</a>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        // Elements
        const gameContainer = document.getElementById('game-container');
        const gameArea = document.getElementById('game-area');
        const startScreen = document.getElementById('start-screen');
        const playBtn = document.getElementById('playBtn');
        const restartBtn = document.getElementById('restartBtn');
        const screenshotBtn = document.getElementById('screenshotBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const scoreDisplay = document.getElementById('score');
        const missesDisplay = document.getElementById('misses');
        const highScoreDisplay = document.getElementById('high-score');
        const gameOverDisplay = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalHighScoreDisplay = document.getElementById('final-high-score');
        const tiktokShare = document.getElementById('tiktokShare');
        const facebookShare = document.getElementById('facebookShare');

        // State
        let score = 0;
        let misses = 0;
        let highScore = parseInt(localStorage.getItem('highScore') || '0', 10) || 0;
        let gameActive = false;
        let spawnIntervalId = null;
        let activeItems = [];
        let deviceId = localStorage.getItem('deviceId') || generateDeviceId();

        highScoreDisplay.textContent = `‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ${highScore}`;

        // Full-screen handling
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                gameContainer.requestFullscreen().then(() => {
                    gameContainer.classList.add('fullscreen');
                    fullscreenBtn.textContent = '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§® ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç';
                }).catch(err => {
                    console.error('Fullscreen error:', err);
                    alert('‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§® ‡§Æ‡•ã‡§°‡§Æ‡§æ ‡§ú‡§æ‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§');
                });
            } else {
                document.exitFullscreen().then(() => {
                    gameContainer.classList.remove('fullscreen');
                    fullscreenBtn.textContent = '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®';
                }).catch(err => {
                    console.error('Exit fullscreen error:', err);
                    alert('‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§¨‡§æ‡§ü ‡§¨‡§æ‡§π‡§ø‡§∞ ‡§®‡§ø‡§∏‡•ç‡§ï‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§');
                });
            }
        }

        // Update button text on fullscreen change
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                gameContainer.classList.remove('fullscreen');
                fullscreenBtn.textContent = '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®';
            } else {
                gameContainer.classList.add('fullscreen');
                fullscreenBtn.textContent = '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§® ‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç';
            }
        });

        // Generate a unique device ID
        function generateDeviceId() {
            const id = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            localStorage.setItem('deviceId', id);
            return id;
        }

        // LocalStorage for high score
        function setHighScore(value) {
            localStorage.setItem('highScore', value);
        }

        // Fall speed depends on score
        function getFallSpeed() {
            if (score <= 10) return 1 + Math.random() * 1;
            if (score <= 20) return 3 + Math.random() * 2;
            if (score <= 30) return 5 + Math.random() * 2;
            return 7 + Math.random() * 2;
        }

        // Create splash
        function createSplash(x, y) {
            const splash = document.createElement('div');
            splash.className = 'splash';
            splash.style.left = `${x - 35}px`;
            splash.style.top = `${y - 10}px`;
            gameArea.appendChild(splash);
            setTimeout(() => splash.remove(), 800);
        }

        // Fruit types
        const types = ['apple', 'mango', 'banana', 'strawberry', 'grapes', 'blueberry'];

        // Create and animate an item
        function createItem() {
            if (!gameActive) return;
            const item = document.createElement('div');
            const type = types[Math.floor(Math.random() * types.length)];
            item.classList.add('item', type);

            gameArea.appendChild(item);

            const itemRect = item.getBoundingClientRect();
            const itemW = itemRect.width;
            const itemH = itemRect.height;

            const areaRect = gameArea.getBoundingClientRect();
            const maxX = Math.max(0, areaRect.width - itemW);

            const left = Math.random() * maxX;
            item.style.left = `${left}px`;
            item.style.top = `${-itemH}px`;

            const fallSpeed = getFallSpeed();

            let rafId = null;
            function fall() {
                if (!gameActive) {
                    if (item.parentElement) item.remove();
                    cancelAnimationFrame(rafId);
                    activeItems = activeItems.filter(a => a.el !== item);
                    return;
                }

                let top = parseFloat(item.style.top || 0);
                top += fallSpeed;
                item.style.top = `${top}px`;

                const bottomY = top + itemH;
                const areaHeight = gameArea.clientHeight;

                if (bottomY >= areaHeight) {
                    const splashX = left + itemW / 2;
                    const splashY = areaHeight - (itemH / 2);
                    createSplash(splashX, splashY);
                    if (item.parentElement) item.remove();
                    activeItems = activeItems.filter(a => a.el !== item);

                    if (gameActive) {
                        misses += 1;
                        missesDisplay.textContent = `‡§ó‡•Å‡§Æ‡§æ‡§è‡§ï‡§æ: ${misses}`;
                        if (misses >= 20) {
                            endGame();
                        }
                    }
                    cancelAnimationFrame(rafId);
                    return;
                }

                rafId = requestAnimationFrame(fall);
            }

            rafId = requestAnimationFrame(fall);
            activeItems.push({ el: item, rafId });

            function onHit(e) {
                e.preventDefault();
                e.stopPropagation();
                if (!gameActive) return;
                score += 1;
                if (score > highScore) {
                    highScore = score;
                    highScoreDisplay.textContent = `‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ${highScore}`;
                    setHighScore(highScore);
                }
                scoreDisplay.textContent = `‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`;
                cancelAnimationFrame(rafId);
                item.removeEventListener('click', onHit);
                item.removeEventListener('touchstart', onHit);
                if (item.parentElement) item.remove();
                activeItems = activeItems.filter(a => a.el !== item);
                createSplash(left + itemW / 2, parseFloat(item.style.top) + itemH / 2);
            }

            item.addEventListener('click', onHit, { passive: false });
            item.addEventListener('touchstart', onHit, { passive: false });
        }

        // Start spawning items
        function startSpawning() {
            if (spawnIntervalId) clearInterval(spawnIntervalId);

            function computeInterval() {
                return Math.max(300, 900 - Math.floor(score * 15));
            }

            createItem();

            spawnIntervalId = setInterval(() => {
                createItem();
                const newInterval = computeInterval();
                if (newInterval !== spawnIntervalId._lastInterval) {
                    clearInterval(spawnIntervalId);
                    spawnIntervalId = setInterval(() => {
                        createItem();
                    }, newInterval);
                    spawnIntervalId._lastInterval = newInterval;
                }
            }, computeInterval());
            spawnIntervalId._lastInterval = computeInterval();
        }

        // End game
        function endGame() {
            gameActive = false;
            finalScoreDisplay.textContent = score;
            finalHighScoreDisplay.textContent = highScore;
            gameOverDisplay.style.display = 'flex';
            startScreen.style.display = 'none';

            if (spawnIntervalId) {
                clearInterval(spawnIntervalId);
                spawnIntervalId = null;
            }

            activeItems.forEach(a => {
                try { cancelAnimationFrame(a.rafId); } catch(e) {}
                if (a.el && a.el.parentElement) a.el.remove();
            });
            activeItems = [];
        }

        function restartGameUIReset() {
            gameOverDisplay.style.display = 'none';
            startScreen.style.display = 'flex';
            activeItems.forEach(a => {
                try { cancelAnimationFrame(a.rafId); } catch(e) {}
                if (a.el && a.el.parentElement) a.el.remove();
            });
            activeItems = [];
            score = 0; 
            misses = 0;
            scoreDisplay.textContent = `‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`;
            missesDisplay.textContent = `‡§ó‡•Å‡§Æ‡§æ‡§è‡§ï‡§æ: ${misses}`;
            gameActive = false;
        }

        // Start game
        function startGame() {
            startScreen.style.display = 'none';
            gameOverDisplay.style.display = 'none';
            score = 0; 
            misses = 0;
            scoreDisplay.textContent = `‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`;
            missesDisplay.textContent = `‡§ó‡•Å‡§Æ‡§æ‡§è‡§ï‡§æ: ${misses}`;
            gameActive = true;
            startSpawning();
        }

        // Screenshot functionality
        function takeScreenshot() {
            if (typeof html2canvas === 'undefined') {
                alert('Screenshot library not yet loaded. Try again in a moment.');
                return;
            }
            html2canvas(gameContainer).then(canvas => {
                const link = document.createElement('a');
                link.download = `‡§´‡§≤_‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•á_‡§ñ‡•á‡§≤_‡§∏‡•ç‡§ï‡•ã‡§∞_${score}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }).catch(err => {
                console.error(err);
                alert('‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§® ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§≠‡§Ø‡•ã‡•§ ‡§ï‡§®‡•ç‡§∏‡•ã‡§≤ ‡§π‡•á‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§');
            });
        }

        // Share handlers
        function shareToTikTok(e) {
            e.preventDefault();
            if (navigator.share) {
                navigator.share({
                    title: `‡§´‡§≤ ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•á ‡§ñ‡•á‡§≤ - ‡§∏‡•ç‡§ï‡•ã‡§∞ ${score}!`,
                    text: `‡§Æ‡•à‡§≤‡•á ‡§´‡§≤ ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•á ‡§ñ‡•á‡§≤‡§Æ‡§æ ${score} ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§¨‡§®‡§æ‡§è‡§Å! ‡§§‡§™‡§æ‡§à‡§Ç ‡§™‡§®‡§ø ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç üéÆ`,
                    url: window.location.href
                }).catch(console.error);
            } else {
                const text = `‡§´‡§≤ ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•á ‡§ñ‡•á‡§≤ - ‡§∏‡•ç‡§ï‡•ã‡§∞ ${score}! ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç! üéâ\n${window.location.href}`;
                navigator.clipboard.writeText(text).then(() => alert('‡§ü‡§ø‡§ï‡§ü‡§ï‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø ‡§≤‡§ø‡§ô‡•ç‡§ï ‡§ï‡§™‡•Ä ‡§≠‡§Ø‡•ã! ‡§™‡•á‡§∏‡•ç‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§')).catch(() => alert('‡§ï‡§™‡•Ä ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§'));
            }
        }
        function shareToFacebook(e) {
            e.preventDefault();
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent('‡§Æ‡•à‡§≤‡•á ‡§´‡§≤ ‡§∏‡§Æ‡§æ‡§§‡•ç‡§®‡•á ‡§ñ‡•á‡§≤‡§Æ‡§æ '+score+' ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§¨‡§®‡§æ‡§è‡§Å! ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç! üéâ')}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        // Wire UI events
        playBtn.addEventListener('click', startGame, { passive: false });
        playBtn.addEventListener('touchstart', startGame, { passive: false });
        restartBtn.addEventListener('click', () => {
            restartGameUIReset();
            startGame();
        }, { passive: false });
        restartBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            restartGameUIReset();
            startGame();
        }, { passive: false });
        screenshotBtn.addEventListener('click', takeScreenshot, { passive: false });
        screenshotBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            takeScreenshot();
        }, { passive: false });
        tiktokShare.addEventListener('click', shareToTikTok, { passive: false });
        tiktokShare.addEventListener('touchstart', shareToTikTok, { passive: false });
        facebookShare.addEventListener('click', shareToFacebook, { passive: false });
        facebookShare.addEventListener('touchstart', shareToFacebook, { passive: false });
        fullscreenBtn.addEventListener('click', toggleFullScreen, { passive: false });
        fullscreenBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            toggleFullScreen();
        }, { passive: false });

        // Prevent page scrolling while touching game container
        gameContainer.addEventListener('touchstart', (e) => {
            if (e.target.classList.contains('item')) return;
            e.preventDefault();
        }, { passive: false });

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (spawnIntervalId) clearInterval(spawnIntervalId);
            activeItems.forEach(a => {
                try { cancelAnimationFrame(a.rafId); } catch(e) {}
            });
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            startScreen.style.display = 'flex';
            gameOverDisplay.style.display = 'none';
            scoreDisplay.textContent = `‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`;
            missesDisplay.textContent = `‡§ó‡•Å‡§Æ‡§æ‡§è‡§ï‡§æ: ${misses}`;
            highScoreDisplay.textContent = `‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ${highScore}`;
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            activeItems.forEach(a => {
                const item = a.el;
                if (!item || !item.parentElement) return;
                const itemRect = item.getBoundingClientRect();
                const areaRect = gameArea.getBoundingClientRect();
                const maxX = Math.max(0, areaRect.width - itemRect.width);
                if (parseFloat(item.style.left) > maxX) {
                    item.style.left = `${maxX}px`;
                }
            });
        });
    </script>
</body>
</html>
