<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ | Puzzle Mania</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            font-family: 'Noto Sans Devanagari', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; display: flex; flex-direction: column; color: #333; overflow-x: hidden;
        }
        .header {
            background: rgba(0, 0, 0, 0.8); padding: 10px; display: flex; align-items: center; justify-content: center; gap: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .header a { color: #ffd700; font-size: clamp(16px, 4vw, 20px); font-weight: 700; text-decoration: none; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); }
        .container { width: 100%; max-width: 900px; margin: 0 auto; padding: 12px; }
        .title { text-align: center; font-size: clamp(20px, 5vw, 28px); font-weight: 700; color: #fff; padding: 10px 0; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); }
        .instructions, .contact { background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 15px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); margin-bottom: 10px; }
        .instructions h2 { font-size: clamp(16px, 4vw, 20px); color: #4a5568; text-align: center; margin-bottom: 8px; }
        .instructions ul { list-style: none; color: #718096; font-size: clamp(12px, 3vw, 14px); }
        .instructions li { margin-bottom: 6px; padding-left: 18px; position: relative; }
        .instructions li::before { content: 'üß©'; position: absolute; left: 0; top: 0; }
        .dashain-message { background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; text-align: center; padding: 12px; border-radius: 15px; margin: 5px 0; font-size: clamp(12px, 3vw, 14px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }

        #game-container {
            position: relative; width: 100%; height: clamp(500px, 80vh, 800px); border-radius: 15px;
            background: linear-gradient(180deg, #87ceeb 0%, #98d8e8 80%, #4a8e4c 100%);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); border: 4px solid #3b5998; overflow: hidden;
        }
        #game-area {
            position: relative; width: 400px; height: 400px; margin: 20px auto; display: grid; grid-template-columns: repeat(4, 1fr); gap: 2px; background: #3b5998; padding: 2px; border-radius: 10px;
        }

        .stats { display: flex; justify-content: space-between; z-index: 200; margin: 10px auto; width: 100%; max-width: 900px; padding: 0 12px; }
        .stat { background: rgba(255, 255, 255, 0.95); padding: 6px 12px; border-radius: 15px; font-size: clamp(12px, 2.5vw, 16px); font-weight: 600; color: #2d3748; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        #high-score, #best-time { background: rgba(255, 215, 0, 0.95); }

        #game-over, #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7);
            display: flex; justify-content: center; align-items: center; z-index: 300;
        }
        #game-over { display: none; flex-direction: column; color: white; text-align: center; gap: 8px; }
        #game-over h2 { font-size: clamp(24px, 6vw, 32px); margin-bottom: 8px; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        #game-over p { font-size: clamp(14px, 3.5vw, 18px); opacity: 0.95; }
        .play-btn, .restart-btn, .screenshot-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 12px 24px; border-radius: 25px; color: white; font-size: clamp(16px, 4vw, 20px); font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
        }
        .play-btn:hover, .restart-btn:hover, .screenshot-btn:hover { transform: translateY(-4px); }

        .share-buttons { display: flex; gap: 8px; margin-top: 8px; }
        .share-btn { padding: 10px 18px; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; color: white; text-decoration: none; }
        .tiktok-btn { background: linear-gradient(45deg, #ff0050, #ff4d6d); box-shadow: 0 4px 15px rgba(255, 0, 80, 0.4); }
        .facebook-btn { background: linear-gradient(45deg, #3b5998, #4267b2); box-shadow: 0 4px 15px rgba(59, 89, 152, 0.4); }

        .tile {
            width: 100px; height: 100px; background-size: 400px 400px; border-radius: 5px; cursor: pointer; transition: transform 0.3s ease; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .tile:hover { transform: scale(1.05); }
        .tile.empty { background: #ffffff; cursor: default; box-shadow: none; }
        .tile.empty:hover { transform: none; }
        .tile-0 { background-image: url('mimage/m7.jpg'); background-position: 0 0; }
        .tile-1 { background-image: url('mimage/m7.jpg'); background-position: -100px 0; }
        .tile-2 { background-image: url('mimage/m7.jpg'); background-position: -200px 0; }
        .tile-3 { background-image: url('mimage/m7.jpg'); background-position: -300px 0; }
        .tile-4 { background-image: url('mimage/m7.jpg'); background-position: 0 -100px; }
        .tile-5 { background-image: url('mimage/m7.jpg'); background-position: -100px -100px; }
        .tile-6 { background-image: url('mimage/m7.jpg'); background-position: -200px -100px; }
        .tile-7 { background-image: url('mimage/m7.jpg'); background-position: -300px -100px; }
        .tile-8 { background-image: url('mimage/m7.jpg'); background-position: 0 -200px; }
        .tile-9 { background-image: url('mimage/m7.jpg'); background-position: -100px -200px; }
        .tile-10 { background-image: url('mimage/m7.jpg'); background-position: -200px -200px; }
        .tile-11 { background-image: url('mimage/m7.jpg'); background-position: -300px -200px; }
        .tile-12 { background-image: url('mimage/m7.jpg'); background-position: 0 -300px; }
        .tile-13 { background-image: url('mimage/m7.jpg'); background-position: -100px -300px; }
        .tile-14 { background-image: url('mimage/m7.jpg'); background-position: -200px -300px; }
        .tile-15 { background: #ffffff; }

        .footer { text-align: center; padding: 10px 0; color: white; font-size: clamp(10px, 2.5vw, 12px); }
        .social-links { display: flex; justify-content: center; gap: 12px; margin-top: 8px; }
        .social-link { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; color: white; font-size: 18px; transition: transform 0.3s ease; }
        .tiktok-social { background: linear-gradient(45deg, #ff0050, #ff4d6d); }
        .facebook-social { background: linear-gradient(45deg, #3b5998, #4267b2); }

        @media (max-width: 768px) {
            .stats { flex-direction: column; gap: 8px; align-items: center; margin-bottom: 10px; }
            .share-buttons { flex-direction: column; width: 80%; }
            #game-container { height: clamp(400px, 70vh, 600px); }
            #game-area { width: 300px; height: 300px; }
            .tile { width: 75px; height: 75px; background-size: 300px 300px; }
            .tile-1 { background-position: -75px 0; }
            .tile-2 { background-position: -150px 0; }
            .tile-3 { background-position: -225px 0; }
            .tile-4 { background-position: 0 -75px; }
            .tile-5 { background-position: -75px -75px; }
            .tile-6 { background-position: -150px -75px; }
            .tile-7 { background-position: -225px -75px; }
            .tile-8 { background-position: 0 -150px; }
            .tile-9 { background-position: -75px -150px; }
            .tile-10 { background-position: -150px -150px; }
            .tile-11 { background-position: -225px -150px; }
            .tile-12 { background-position: 0 -225px; }
            .tile-13 { background-position: -75px -225px; }
            .tile-14 { background-position: -150px -225px; }
        }
        @media (max-width: 480px) {
            #game-container { height: clamp(350px, 65vh, 500px); }
            #game-area { width: 240px; height: 240px; }
            .tile { width: 60px; height: 60px; background-size: 240px 240px; }
            .tile-1 { background-position: -60px 0; }
            .tile-2 { background-position: -120px 0; }
            .tile-3 { background-position: -180px 0; }
            .tile-4 { background-position: 0 -60px; }
            .tile-5 { background-position: -60px -60px; }
            .tile-6 { background-position: -120px -60px; }
            .tile-7 { background-position: -180px -60px; }
            .tile-8 { background-position: 0 -120px; }
            .tile-9 { background-position: -60px -120px; }
            .tile-10 { background-position: -120px -120px; }
            .tile-11 { background-position: -180px -120px; }
            .tile-12 { background-position: 0 -180px; }
            .tile-13 { background-position: -60px -180px; }
            .tile-14 { background-position: -120px -180px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" target="_blank" rel="noopener">RSTECHZEN Game Zone</a>
    </div>

    <div class="container">
        <h1 class="title">‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ</h1>

        <div class="dashain-message">üéâ ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç‡§ï‡•ã ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ! ‡§ü‡§æ‡§á‡§≤‡§π‡§∞‡•Ç ‡§Æ‡§ø‡§≤‡§æ‡§è‡§∞ ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§¨‡§®‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç! ü•≥</div>

        <div class="instructions">
            <h2>‡§ï‡§∏‡§∞‡•Ä ‡§ñ‡•á‡§≤‡•ç‡§®‡•á?</h2>
            <ul>
                <li>‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§® "‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç" ‡§¨‡§ü‡§® ‡§•‡§ø‡§ö‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§ü‡§æ‡§á‡§≤‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§µ‡§æ ‡§ü‡•ç‡§Ø‡§æ‡§™ ‡§ó‡§∞‡•á‡§∞, ‡§µ‡§æ ‡§ï‡§ø‡§¨‡•ã‡§∞‡•ç‡§°‡§ï‡•ã ‡§§‡•Ä‡§∞ ‡§ï‡•Å‡§û‡•ç‡§ú‡•Ä‡§π‡§∞‡•Ç ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•á‡§∞ ‡§ñ‡§æ‡§≤‡•Ä ‡§†‡§æ‡§â‡§Å‡§Æ‡§æ ‡§∏‡•ç‡§≤‡§æ‡§á‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤‡§Æ‡§æ, ‡§ü‡§æ‡§á‡§≤‡§π‡§∞‡•Ç ‡§∏‡•ç‡§µ‡§æ‡§á‡§™ ‡§ó‡§∞‡•á‡§∞ ‡§∏‡§æ‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§æ‡§≤‡§≤‡•á ‡§ó‡§≤‡•ç‡§§‡•Ä ‡§ó‡§£‡§®‡§æ ‡§ó‡§∞‡•ç‡§õ‡•§</li>
                <li>‡§∏‡§¨‡•à ‡§ü‡§æ‡§á‡§≤‡§π‡§∞‡•Ç ‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§Æ‡§æ ‡§Æ‡§ø‡§≤‡§æ‡§è‡§∞ ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§™‡•Ç‡§∞‡§æ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!</li>
            </ul>
        </div>

        <div class="stats">
            <div class="stat" id="moves">‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: ‡•¶</div>
            <div class="stat" id="mistakes">‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ‡•¶</div>
            <div class="stat" id="timer">‡§∏‡§Æ‡§Ø: ‡•¶:‡•¶‡•¶</div>
            <div class="stat" id="best-time">‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: --:--</div>
        </div>

        <div id="game-container">
            <div id="game-area"></div>

            <div id="start-screen">
                <button class="play-btn" id="playBtn">‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
            </div>

            <div id="game-over">
                <h2>‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!</h2>
                <p>‡§ï‡•Å‡§≤ ‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: <span id="final-moves">‡•¶</span></p>
                <p>‡§ï‡•Å‡§≤ ‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: <span id="final-mistakes">‡•¶</span></p>
                <p>‡§∏‡§Æ‡§Ø: <span id="final-time">‡•¶:‡•¶‡•¶</span></p>
                <p>‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: <span id="final-best-time">--:--</span></p>
                <button class="restart-btn" id="restartBtn">‡§´‡•á‡§∞‡§ø ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <button class="screenshot-btn" id="screenshotBtn">‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <div class="share-buttons">
                    <a href="#" class="share-btn tiktok-btn" id="tiktokShare">üì± ‡§ü‡§ø‡§ï‡§ü‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                    <a href="#" class="share-btn facebook-btn" id="facebookShare">üìò ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                </div>
            </div>
        </div>

        <div class="contact">
            <p>‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï: <a href="tel:9808942229">9808942229</a> | ‡§á‡§Æ‡•á‡§≤: <a href="mailto:rstechzen@gmail.com">rstechzen@gmail.com</a></p>
        </div>

        <div class="footer">
            <p>‡§µ‡§ø‡§ï‡§æ‡§∏‡§ï‡§∞‡•ç‡§§‡§æ: ‡§∞‡§∏‡•ç‡§ü‡•á‡§ï‡§ú‡•á‡§® | Social ID: @rstechzen | <a href="https://rstechzen.rf.gd/" target="_blank" rel="noopener">‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü</a></p>
            <p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§ü‡§ø‡§ï‡§ü‡§ï ‡§∞ ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§π‡§æ‡§Æ‡•Ä‡§≤‡§æ‡§à ‡§´‡§≤‡•ã ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!</p>
            <div class="social-links">
                <a href="https://www.facebook.com/rstechzen" class="social-link facebook-social" target="_blank" rel="noopener" aria-label="Facebook">f</a>
                <a href="https://www.tiktok.com/@rstechzen" class="social-link tiktok-social" target="_blank" rel="noopener" aria-label="TikTok">‚ô¨</a>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Elements
        const gameContainer = document.getElementById('game-container');
        const gameArea = document.getElementById('game-area');
        const startScreen = document.getElementById('start-screen');
        const playBtn = document.getElementById('playBtn');
        const restartBtn = document.getElementById('restartBtn');
        const screenshotBtn = document.getElementById('screenshotBtn');
        const movesDisplay = document.getElementById('moves');
        const mistakesDisplay = document.getElementById('mistakes');
        const timerDisplay = document.getElementById('timer');
        const bestTimeDisplay = document.getElementById('best-time');
        const gameOverDisplay = document.getElementById('game-over');
        const finalMovesDisplay = document.getElementById('final-moves');
        const finalMistakesDisplay = document.getElementById('final-mistakes');
        const finalTimeDisplay = document.getElementById('final-time');
        const finalBestTimeDisplay = document.getElementById('final-best-time');
        const tiktokShare = document.getElementById('tiktokShare');
        const facebookShare = document.getElementById('facebookShare');

        // State
        let moves = 0;
        let mistakes = 0;
        let seconds = 0;
        let timerInterval = null;
        let bestTime = parseInt(localStorage.getItem('puzzleManiaBestTime') || '0', 10) || 0;
        let gameActive = false;
        let tiles = [];
        let board = [];
        const gridSize = 4; // 4x4 grid
        const totalTiles = gridSize * gridSize;

        // Initialize displays
        bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${bestTime ? formatTime(bestTime) : '--:--'}`;

        // Format time (seconds to mm:ss)
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        // Start timer
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            seconds = 0;
            timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
            timerInterval = setInterval(() => {
                if (gameActive) {
                    seconds += 1;
                    timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
                }
            }, 1000);
        }

        // Save best time
        function setBestTime(value) {
            localStorage.setItem('puzzleManiaBestTime', value);
        }

        // Shuffle array (ensure solvable puzzle)
        function shuffleBoard() {
            let numbers = Array.from({ length: totalTiles }, (_, i) => i);
            let inversions;
            do {
                // Fisher-Yates shuffle
                for (let i = numbers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
                }
                // Calculate inversions to ensure solvability
                inversions = 0;
                for (let i = 0; i < totalTiles - 1; i++) {
                    for (let j = i + 1; j < totalTiles; j++) {
                        if (numbers[i] < numbers[j] && numbers[i] !== totalTiles - 1 && numbers[j] !== totalTiles - 1) {
                            inversions++;
                        }
                    }
                }
                // For a 4x4 puzzle, inversions + empty tile row (1-based) must be odd
                const emptyIndex = numbers.indexOf(totalTiles - 1);
                const emptyRow = Math.floor(emptyIndex / gridSize) + 1;
                const isSolvable = (inversions + emptyRow) % 2 === 1;
                if (!isSolvable) continue;
                return numbers;
            } while (true);
        }

        // Create tile
        function createTile(number) {
            const tile = document.createElement('div');
            tile.classList.add('tile', `tile-${number}`);
            if (number === totalTiles - 1) tile.classList.add('empty');
            tile.dataset.number = number;
            tile.addEventListener('click', () => handleTileClick(number));
            return tile;
        }

        // Initialize game
        function initGame() {
            gameArea.innerHTML = '';
            tiles = [];
            moves = 0;
            mistakes = 0;
            seconds = 0;
            movesDisplay.textContent = `‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: ${moves}`;
            mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
            timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
            board = shuffleBoard();
            board.forEach((number, index) => {
                const tile = createTile(number);
                gameArea.appendChild(tile);
                tiles.push(tile);
            });
        }

        // Find empty tile position
        function getEmptyPosition() {
            return board.indexOf(totalTiles - 1);
        }

        // Check if tile can move
        function canMoveTile(tileIndex) {
            const emptyIndex = getEmptyPosition();
            const tileRow = Math.floor(tileIndex / gridSize);
            const tileCol = tileIndex % gridSize;
            const emptyRow = Math.floor(emptyIndex / gridSize);
            const emptyCol = emptyIndex % gridSize;
            return (tileRow === emptyRow && Math.abs(tileCol - emptyCol) === 1) ||
                   (tileCol === emptyCol && Math.abs(tileRow - emptyRow) === 1);
        }

        // Move tile to empty position
        function moveTile(tileIndex) {
            if (!gameActive) return;
            if (canMoveTile(tileIndex)) {
                const emptyIndex = getEmptyPosition();
                [board[tileIndex], board[emptyIndex]] = [board[emptyIndex], board[tileIndex]];
                moves += 1;
                movesDisplay.textContent = `‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: ${moves}`;
                updateBoard();
                if (isSolved()) {
                    endGame();
                }
                return true;
            } else {
                mistakes += 1;
                mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
                return false;
            }
        }

        // Handle tile click
        function handleTileClick(number) {
            if (!gameActive) return;
            const tileIndex = board.indexOf(number);
            moveTile(tileIndex);
        }

        // Handle keyboard input
        function handleKeyboardInput(e) {
            if (!gameActive) return;
            const emptyIndex = getEmptyPosition();
            const emptyRow = Math.floor(emptyIndex / gridSize);
            const emptyCol = emptyIndex % gridSize;
            let tileIndex = -1;

            switch (e.key) {
                case 'ArrowUp':
                    if (emptyRow < gridSize - 1) tileIndex = (emptyRow + 1) * gridSize + emptyCol;
                    break;
                case 'ArrowDown':
                    if (emptyRow > 0) tileIndex = (emptyRow - 1) * gridSize + emptyCol;
                    break;
                case 'ArrowLeft':
                    if (emptyCol < gridSize - 1) tileIndex = emptyRow * gridSize + emptyCol + 1;
                    break;
                case 'ArrowRight':
                    if (emptyCol > 0) tileIndex = emptyRow * gridSize + emptyCol - 1;
                    break;
            }

            if (tileIndex !== -1) {
                moveTile(tileIndex);
            }
        }

        // Update board display
        function updateBoard() {
            tiles.forEach((tile, index) => {
                const number = board[index];
                tile.className = `tile tile-${number}`;
                if (number === totalTiles - 1) tile.classList.add('empty');
                tile.dataset.number = number;
            });
        }

        // Check if puzzle is solved
        function isSolved() {
            return board.every((number, index) => number === index);
        }

        // Start game
        function startGame() {
            startScreen.style.display = 'none';
            gameOverDisplay.style.display = 'none';
            gameActive = true;
            initGame();
            startTimer();
        }

        // End game
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            if (!bestTime || seconds < bestTime) {
                bestTime = seconds;
                bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${formatTime(bestTime)}`;
                setBestTime(bestTime);
            }
            finalMovesDisplay.textContent = moves;
            finalMistakesDisplay.textContent = mistakes;
            finalTimeDisplay.textContent = formatTime(seconds);
            finalBestTimeDisplay.textContent = bestTime ? formatTime(bestTime) : '--:--';
            gameOverDisplay.style.display = 'flex';
        }

        // Restart game
        function restartGame() {
            gameOverDisplay.style.display = 'none';
            startScreen.style.display = 'flex';
            gameActive = false;
            clearInterval(timerInterval);
            initGame();
        }

        // Screenshot functionality
        function takeScreenshot() {
            if (typeof html2canvas === 'undefined') {
                alert('Screenshot library not yet loaded. Try again in a moment.');
                return;
            }
            html2canvas(gameContainer).then(canvas => {
                const link = document.createElement('a');
                link.download = `‡§™‡§ú‡§≤_‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ_‡§∏‡§Æ‡§Ø_${formatTime(seconds)}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }).catch(err => {
                console.error(err);
                alert('‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§® ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§≠‡§Ø‡•ã‡•§ ‡§ï‡§®‡•ç‡§∏‡•ã‡§≤ ‡§π‡•á‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§');
            });
        }

        // Share handlers
        function shareToTikTok(e) {
            e.preventDefault();
            if (navigator.share) {
                navigator.share({
                    title: `‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ - ‡§∏‡§Æ‡§Ø ${formatTime(seconds)}!`,
                    text: `‡§Æ‡•à‡§≤‡•á ‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ‡§Æ‡§æ ${formatTime(seconds)} ‡§∏‡§Æ‡§Ø‡§Æ‡§æ ‡§™‡§ú‡§≤ ‡§∏‡§≤‡•ç‡§≠ ‡§ó‡§∞‡•á‡§Ç! ‡§§‡§™‡§æ‡§à‡§Ç ‡§™‡§®‡§ø ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç üéÆ`,
                    url: window.location.href
                }).catch(console.error);
            } else {
                const text = `‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ - ‡§∏‡§Æ‡§Ø ${formatTime(seconds)}! ${moves} ‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§™‡§ú‡§≤ ‡§∏‡§≤‡•ç‡§≠! ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç! üéâ\n${window.location.href}`;
                navigator.clipboard.writeText(text).then(() => alert('‡§ü‡§ø‡§ï‡§ü‡§ï‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø ‡§≤‡§ø‡§ô‡•ç‡§ï ‡§ï‡§™‡•Ä ‡§≠‡§Ø‡•ã! ‡§™‡•á‡§∏‡•ç‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§')).catch(() => alert('‡§ï‡§™‡•Ä ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§'));
            }
        }

        function shareToFacebook(e) {
            e.preventDefault();
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent('‡§Æ‡•à‡§≤‡•á ‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ‡§Æ‡§æ ' + formatTime(seconds) + ' ‡§∏‡§Æ‡§Ø‡§Æ‡§æ ‡§∞ ' + moves + ' ‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§™‡§ú‡§≤ ‡§∏‡§≤‡•ç‡§≠ ‡§ó‡§∞‡•á‡§Ç! ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç! üéâ')}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        // Event listeners
        playBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', () => {
            restartGame();
            startGame();
        });
        screenshotBtn.addEventListener('click', takeScreenshot);
        tiktokShare.addEventListener('click', shareToTikTok);
        facebookShare.addEventListener('click', shareToFacebook);

        // Keyboard support
        document.addEventListener('keydown', handleKeyboardInput);

        // Touch support for swipe gestures
        let touchStartX = 0, touchStartY = 0;
        gameContainer.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: false });

        gameContainer.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (!gameActive) return;
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const minSwipeDistance = 30;

            const emptyIndex = getEmptyPosition();
            const emptyRow = Math.floor(emptyIndex / gridSize);
            const emptyCol = emptyIndex % gridSize;
            let tileIndex = -1;

            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0 && emptyCol < gridSize - 1) {
                    // Swipe right: move tile left of empty space
                    tileIndex = emptyRow * gridSize + emptyCol + 1;
                } else if (deltaX < 0 && emptyCol > 0) {
                    // Swipe left: move tile right of empty space
                    tileIndex = emptyRow * gridSize + emptyCol - 1;
                }
            } else if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > minSwipeDistance) {
                if (deltaY > 0 && emptyRow < gridSize - 1) {
                    // Swipe down: move tile above empty space
                    tileIndex = (emptyRow + 1) * gridSize + emptyCol;
                } else if (deltaY < 0 && emptyRow > 0) {
                    // Swipe up: move tile below empty space
                    tileIndex = (emptyRow - 1) * gridSize + emptyCol;
                }
            }

            if (tileIndex !== -1) {
                moveTile(tileIndex);
            }
        }, { passive: false });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            startScreen.style.display = 'flex';
            gameOverDisplay.style.display = 'none';
            movesDisplay.textContent = `‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: ${moves}`;
            mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
            timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
            bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${bestTime ? formatTime(bestTime) : '--:--'}`;
            initGame();
        });

        // Clean up on unload
        window.addEventListener('beforeunload', () => {
            gameActive = false;
            clearInterval(timerInterval);
        });
    </script>
</body>
</html>