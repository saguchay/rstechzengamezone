<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ | Puzzle Mania</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            font-family: 'Noto Sans Devanagari', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            min-height: 100vh; display: flex; flex-direction: column; color: #333;
            overscroll-behavior: none; touch-action: manipulation;
        }
        .header {
            background: rgba(0, 0, 0, 0.8); padding: 10px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .header a {
            color: #ffd700; font-size: clamp(16px, 4vw, 18px); font-weight: 700; text-decoration: none;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        .container { width: 100%; max-width: 900px; margin: 0 auto; padding: 12px; }
        .title { text-align: center; font-size: clamp(20px, 5vw, 26px); font-weight: 700; color: #fff; padding: 10px 0; }
        .instructions, .contact {
            background: rgba(255, 255, 255, 0.95); border-radius: 10px; padding: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); margin-bottom: 10px;
        }
        .instructions h2 { font-size: clamp(16px, 4vw, 18px); color: #4a5568; text-align: center; margin-bottom: 8px; }
        .instructions ul { list-style: none; color: #718096; font-size: clamp(12px, 3vw, 14px); }
        .instructions li { margin-bottom: 6px; padding-left: 18px; position: relative; }
        .instructions li::before { content: 'üß©'; position: absolute; left: 0; }
        .dashain-message {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; text-align: center;
            padding: 10px; border-radius: 10px; margin: 5px 0; font-size: clamp(12px, 3vw, 14px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }

        #game-container {
            position: relative; width: 100%; max-width: 500px; margin: 0 auto;
            border-radius: 10px; background: linear-gradient(180deg, #87ceeb, #4a8e4c);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); border: 3px solid #3b5998; overflow: hidden;
            aspect-ratio: 1 / 1; touch-action: none;
        }
        #game-area {
            position: relative; width: 100%; height: 100%; display: grid;
            grid-template-columns: repeat(4, 1fr); gap: 2px; background: #3b5998; padding: 2px;
            border-radius: 8px;
        }

        .stats {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;
            margin: 10px auto; width: 100%; max-width: 500px; padding: 0 12px;
        }
        .stat {
            background: rgba(255, 255, 255, 0.95); padding: 6px 12px; border-radius: 10px;
            font-size: clamp(12px, 2.5vw, 14px); font-weight: 600; color: #2d3748;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); flex: 1; text-align: center;
        }
        #high-score, #best-time { background: rgba(255, 215, 0, 0.95); }

        #game-over, #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 300;
        }
        #game-over { display: none; color: white; text-align: center; gap: 8px; }
        #game-over h2 { font-size: clamp(20px, 5vw, 24px); margin-bottom: 8px; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); -webkit-background-clip: text; background-clip: text; color: transparent; }
        #game-over p { font-size: clamp(12px, 3vw, 14px); opacity: 0.95; }
        .play-btn, .restart-btn, .screenshot-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none;
            padding: 10px 20px; border-radius: 20px; color: white; font-size: clamp(14px, 3.5vw, 16px);
            font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(78, 205, 196, 0.4);
            transition: transform 0.2s;
        }
        .play-btn:hover, .restart-btn:hover, .screenshot-btn:hover { transform: translateY(-2px); }

        .share-buttons { display: flex; flex-direction: column; gap: 8px; margin-top: 8px; width: 80%; }
        .share-btn {
            padding: 8px 16px; border-radius: 15px; font-size: clamp(12px, 3vw, 14px);
            font-weight: 600; cursor: pointer; color: white; text-decoration: none; text-align: center;
        }
        .tiktok-btn { background: linear-gradient(45deg, #ff0050, #ff4d6d); }
        .facebook-btn { background: linear-gradient(45deg, #3b5998, #4267b2); }

        .tile {
            width: 100%; height: 100%; background-size: cover; border-radius: 5px;
            cursor: pointer; transition: transform 0.2s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            touch-action: none;
        }
        .tile:hover { transform: scale(1.03); }
        .tile.empty { background: #ffffff; cursor: default; box-shadow: none; }
        .tile.empty:hover { transform: none; }
        .tile-0 { background-image: url('mimage/m7.jpg'); background-position: 0 0; }
        .tile-1 { background-image: url('mimage/m7.jpg'); background-position: -33.33% 0; }
        .tile-2 { background-image: url('mimage/m7.jpg'); background-position: -66.67% 0; }
        .tile-3 { background-image: url('mimage/m7.jpg'); background-position: -100% 0; }
        .tile-4 { background-image: url('mimage/m7.jpg'); background-position: 0 -33.33%; }
        .tile-5 { background-image: url('mimage/m7.jpg'); background-position: -33.33% -33.33%; }
        .tile-6 { background-image: url('mimage/m7.jpg'); background-position: -66.67% -33.33%; }
        .tile-7 { background-image: url('mimage/m7.jpg'); background-position: -100% -33.33%; }
        .tile-8 { background-image: url('mimage/m7.jpg'); background-position: 0 -66.67%; }
        .tile-9 { background-image: url('mimage/m7.jpg'); background-position: -33.33% -66.67%; }
        .tile-10 { background-image: url('mimage/m7.jpg'); background-position: -66.67% -66.67%; }
        .tile-11 { background-image: url('mimage/m7.jpg'); background-position: -100% -66.67%; }
        .tile-12 { background-image: url('mimage/m7.jpg'); background-position: 0 -100%; }
        .tile-13 { background-image: url('mimage/m7.jpg'); background-position: -33.33% -100%; }
        .tile-14 { background-image: url('mimage/m7.jpg'); background-position: -66.67% -100%; }
        .tile-15 { background: #ffffff; }

        .footer { text-align: center; padding: 10px 0; color: white; font-size: clamp(10px, 2.5vw, 12px); }
        .social-links { display: flex; justify-content: center; gap: 10px; margin-top: 8px; }
        .social-link { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; text-decoration: none; }
        .tiktok-social { background: linear-gradient(45deg, #ff0050, #ff4d6d); }
        .facebook-social { background: linear-gradient(45deg, #3b5998, #4267b2); }

        @media (max-width: 768px) {
            .stats { flex-direction: column; align-items: center; }
            .stat { width: 100%; max-width: 300px; }
            #game-container { max-width: 400px; }
        }
        @media (max-width: 480px) {
            .container { padding: 8px; }
            #game-container { max-width: 300px; }
            .title { font-size: clamp(18px, 4.5vw, 22px); }
            .instructions h2 { font-size: clamp(14px, 3.5vw, 16px); }
            .instructions ul { font-size: clamp(10px, 2.5vw, 12px); }
            .dashain-message { font-size: clamp(10px, 2.5vw, 12px); }
            .play-btn, .restart-btn, .screenshot-btn { padding: 8px 16px; font-size: clamp(12px, 3vw, 14px); }
            .share-btn { padding: 6px 12px; font-size: clamp(10px, 2.5vw, 12px); }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" target="_blank" rel="noopener">RSTECHZEN Game Zone</a>
    </div>

    <div class="container">
        <h1 class="title">‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ</h1>

        <div class="dashain-message">üéâ ‡§∂‡•Å‡§≠ ‡§¶‡§∂‡•à‡§Ç‡§ï‡•ã ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ! ‡§ü‡§æ‡§á‡§≤‡§π‡§∞‡•Ç ‡§Æ‡§ø‡§≤‡§æ‡§è‡§∞ ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§¨‡§®‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç! ü•≥</div>

        

        <div class="stats">
            <div class="stat" id="moves">‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: ‡•¶</div>
            <div class="stat" id="mistakes">‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ‡•¶</div>
            <div class="stat" id="timer">‡§∏‡§Æ‡§Ø: ‡•¶:‡•¶‡•¶</div>
            <div class="stat" id="best-time">‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: --:--</div>
        </div>

        <div id="game-container">
            <div id="game-area"></div>

            <div id="start-screen">
                <button class="play-btn" id="playBtn">‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
            </div>

            <div id="game-over">
                <h2>‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!</h2>
                <p>‡§ï‡•Å‡§≤ ‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: <span id="final-moves">‡•¶</span></p>
                <p>‡§ï‡•Å‡§≤ ‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: <span id="final-mistakes">‡•¶</span></p>
                <p>‡§∏‡§Æ‡§Ø: <span id="final-time">‡•¶:‡•¶‡•¶</span></p>
                <p>‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: <span id="final-best-time">--:--</span></p>
                <button class="restart-btn" id="restartBtn">‡§´‡•á‡§∞‡§ø ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <button class="screenshot-btn" id="screenshotBtn">‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
                <div class="share-buttons">
                    <a href="#" class="share-btn tiktok-btn" id="tiktokShare">üì± ‡§ü‡§ø‡§ï‡§ü‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                    <a href="#" class="share-btn facebook-btn" id="facebookShare">üìò ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</a>
                </div>
            </div>
        </div>


        <div class="instructions">
            <h2>‡§ï‡§∏‡§∞‡•Ä ‡§ñ‡•á‡§≤‡•ç‡§®‡•á?</h2>
            <ul>
                <li>‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§® "‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç" ‡§¨‡§ü‡§® ‡§•‡§ø‡§ö‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§ü‡§æ‡§á‡§≤‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§ü‡•ç‡§Ø‡§æ‡§™ ‡§µ‡§æ ‡§∏‡•ç‡§µ‡§æ‡§á‡§™ ‡§ó‡§∞‡•á‡§∞ ‡§ñ‡§æ‡§≤‡•Ä ‡§†‡§æ‡§â‡§Å‡§Æ‡§æ ‡§∏‡•ç‡§≤‡§æ‡§á‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</li>
                <li>‡§ï‡§ø‡§¨‡•ã‡§∞‡•ç‡§°‡§ï‡•ã ‡§§‡•Ä‡§∞ ‡§ï‡•Å‡§û‡•ç‡§ú‡•Ä‡§π‡§∞‡•Ç ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§®‡•ç‡§õ‡•§</li>
                <li>‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§æ‡§≤‡§≤‡•á ‡§ó‡§≤‡•ç‡§§‡•Ä ‡§ó‡§£‡§®‡§æ ‡§ó‡§∞‡•ç‡§õ‡•§</li>
                <li>‡§ü‡§æ‡§á‡§≤‡§π‡§∞‡•Ç ‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§Æ‡§æ ‡§Æ‡§ø‡§≤‡§æ‡§è‡§∞ ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§™‡•Ç‡§∞‡§æ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!</li>
            </ul>
        </div>
        <div class="contact">
            <p>‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï: <a href="tel:9808942229">9808942229</a> | ‡§á‡§Æ‡•á‡§≤: <a href="mailto:rstechzen@gmail.com">rstechzen@gmail.com</a></p>
        </div>

        <div class="footer">
            <p>‡§µ‡§ø‡§ï‡§æ‡§∏‡§ï‡§∞‡•ç‡§§‡§æ: ‡§∞‡§∏‡•ç‡§ü‡•á‡§ï‡§ú‡•á‡§® | Social ID: @rstechzen | <a href="https://rstechzen.rf.gd/" target="_blank" rel="noopener">‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü</a></p>
            <p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§ü‡§ø‡§ï‡§ü‡§ï ‡§∞ ‡§´‡•á‡§∏‡§¨‡•Å‡§ï‡§Æ‡§æ ‡§π‡§æ‡§Æ‡•Ä‡§≤‡§æ‡§à ‡§´‡§≤‡•ã ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!</p>
            <div class="social-links">
                <a href="https://www.facebook.com/rstechzen" class="social-link facebook-social" target="_blank" rel="noopener" aria-label="Facebook">f</a>
                <a href="https://www.tiktok.com/@rstechzen" class="social-link tiktok-social" target="_blank" rel="noopener" aria-label="TikTok">‚ô¨</a>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Elements
        const gameContainer = document.getElementById('game-container');
        const gameArea = document.getElementById('game-area');
        const startScreen = document.getElementById('start-screen');
        const playBtn = document.getElementById('playBtn');
        const restartBtn = document.getElementById('restartBtn');
        const screenshotBtn = document.getElementById('screenshotBtn');
        const movesDisplay = document.getElementById('moves');
        const mistakesDisplay = document.getElementById('mistakes');
        const timerDisplay = document.getElementById('timer');
        const bestTimeDisplay = document.getElementById('best-time');
        const gameOverDisplay = document.getElementById('game-over');
        const finalMovesDisplay = document.getElementById('final-moves');
        const finalMistakesDisplay = document.getElementById('final-mistakes');
        const finalTimeDisplay = document.getElementById('final-time');
        const finalBestTimeDisplay = document.getElementById('final-best-time');
        const tiktokShare = document.getElementById('tiktokShare');
        const facebookShare = document.getElementById('facebookShare');

        // State
        let moves = 0;
        let mistakes = 0;
        let seconds = 0;
        let timerInterval = null;
        let bestTime = parseInt(localStorage.getItem('puzzleManiaBestTime') || '0', 10) || 0;
        let gameActive = false;
        let tiles = [];
        let board = [];
        const gridSize = 4;
        const totalTiles = gridSize * gridSize;

        // Initialize displays
        bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${bestTime ? formatTime(bestTime) : '--:--'}`;

        // Format time
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        // Start timer
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            seconds = 0;
            timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
            timerInterval = setInterval(() => {
                if (gameActive) {
                    seconds++;
                    timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
                }
            }, 1000);
        }

        // Save best time
        function setBestTime(value) {
            localStorage.setItem('puzzleManiaBestTime', value);
        }

        // Shuffle board (ensure solvable)
        function shuffleBoard() {
            let numbers = Array.from({ length: totalTiles }, (_, i) => i);
            let inversions;
            do {
                for (let i = numbers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
                }
                inversions = 0;
                for (let i = 0; i < totalTiles - 1; i++) {
                    for (let j = i + 1; j < totalTiles; j++) {
                        if (numbers[i] < numbers[j] && numbers[i] !== totalTiles - 1 && numbers[j] !== totalTiles - 1) {
                            inversions++;
                        }
                    }
                }
                const emptyIndex = numbers.indexOf(totalTiles - 1);
                const emptyRow = Math.floor(emptyIndex / gridSize) + 1;
                if ((inversions + emptyRow) % 2 === 1) return numbers;
            } while (true);
        }

        // Create tile
        function createTile(number) {
            const tile = document.createElement('div');
            tile.classList.add('tile', `tile-${number}`);
            if (number === totalTiles - 1) tile.classList.add('empty');
            tile.dataset.number = number;
            tile.addEventListener('click', () => handleTileClick(number));
            return tile;
        }

        // Initialize game
        function initGame() {
            gameArea.innerHTML = '';
            tiles = [];
            moves = 0;
            mistakes = 0;
            seconds = 0;
            movesDisplay.textContent = `‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: ${moves}`;
            mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
            timerDisplay.textContent = `‡§∏‡§Æ‡§Ø: ${formatTime(seconds)}`;
            board = shuffleBoard();
            board.forEach((number, index) => {
                const tile = createTile(number);
                gameArea.appendChild(tile);
                tiles.push(tile);
            });
        }

        // Get empty tile position
        function getEmptyPosition() {
            return board.indexOf(totalTiles - 1);
        }

        // Check if tile can move
        function canMoveTile(tileIndex) {
            const emptyIndex = getEmptyPosition();
            const tileRow = Math.floor(tileIndex / gridSize);
            const tileCol = tileIndex % gridSize;
            const emptyRow = Math.floor(emptyIndex / gridSize);
            const emptyCol = emptyIndex % gridSize;
            return (tileRow === emptyRow && Math.abs(tileCol - emptyCol) === 1) ||
                   (tileCol === emptyCol && Math.abs(tileRow - emptyRow) === 1);
        }

        // Move tile
        function moveTile(tileIndex) {
            if (!gameActive) return;
            if (canMoveTile(tileIndex)) {
                const emptyIndex = getEmptyPosition();
                [board[tileIndex], board[emptyIndex]] = [board[emptyIndex], board[tileIndex]];
                moves++;
                movesDisplay.textContent = `‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç: ${moves}`;
                updateBoard();
                if (isSolved()) endGame();
            } else {
                mistakes++;
                mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
            }
        }

        // Handle tile click
        function handleTileClick(number) {
            if (!gameActive) return;
            const tileIndex = board.indexOf(number);
            moveTile(tileIndex);
        }

        // Handle keyboard input
        function handleKeyboardInput(e) {
            if (!gameActive) return;
            const emptyIndex = getEmptyPosition();
            const emptyRow = Math.floor(emptyIndex / gridSize);
            const emptyCol = emptyIndex % gridSize;
            let tileIndex = -1;

            switch (e.key) {
                case 'ArrowUp': if (emptyRow < gridSize - 1) tileIndex = (emptyRow + 1) * gridSize + emptyCol; break;
                case 'ArrowDown': if (emptyRow > 0) tileIndex = (emptyRow - 1) * gridSize + emptyCol; break;
                case 'ArrowLeft': if (emptyCol < gridSize - 1) tileIndex = emptyRow * gridSize + emptyCol + 1; break;
                case 'ArrowRight': if (emptyCol > 0) tileIndex = emptyRow * gridSize + emptyCol - 1; break;
            }

            if (tileIndex !== -1) moveTile(tileIndex);
        }

        // Update board
        function updateBoard() {
            tiles.forEach((tile, index) => {
                const number = board[index];
                tile.className = `tile tile-${number}`;
                if (number === totalTiles - 1) tile.classList.add('empty');
                tile.dataset.number = number;
            });
        }

        // Check if solved
        function isSolved() {
            return board.every((number, index) => number === index);
        }

        // Start game
        function startGame() {
            startScreen.style.display = 'none';
            gameOverDisplay.style.display = 'none';
            gameActive = true;
            initGame();
            startTimer();
        }

        // End game
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            if (!bestTime || seconds < bestTime) {
                bestTime = seconds;
                bestTimeDisplay.textContent = `‡§â‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§Ø: ${formatTime(bestTime)}`;
                setBestTime(bestTime);
            }
            finalMovesDisplay.textContent = moves;
            finalMistakesDisplay.textContent = mistakes;
            finalTimeDisplay.textContent = formatTime(seconds);
            finalBestTimeDisplay.textContent = bestTime ? formatTime(bestTime) : '--:--';
            gameOverDisplay.style.display = 'flex';
        }

        // Restart game
        function restartGame() {
            gameOverDisplay.style.display = 'none';
            startScreen.style.display = 'flex';
            gameActive = false;
            clearInterval(timerInterval);
            initGame();
        }

        // Screenshot
        function takeScreenshot() {
            if (typeof html2canvas === 'undefined') {
                alert('‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§≤‡•ã‡§° ‡§≠‡§è‡§ï‡•ã ‡§õ‡•à‡§®‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§õ‡§ø ‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§');
                return;
            }
            html2canvas(gameContainer).then(canvas => {
                const link = document.createElement('a');
                link.download = `‡§™‡§ú‡§≤_‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ_‡§∏‡§Æ‡§Ø_${formatTime(seconds)}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }).catch(err => {
                console.error(err);
                alert('‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∏‡§ü ‡§≤‡§ø‡§® ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§≠‡§Ø‡•ã‡•§');
            });
        }

        // Share handlers
        function shareToTikTok(e) {
            e.preventDefault();
            if (navigator.share) {
                navigator.share({
                    title: `‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ - ‡§∏‡§Æ‡§Ø ${formatTime(seconds)}!`,
                    text: `‡§Æ‡•à‡§≤‡•á ‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ‡§Æ‡§æ ${formatTime(seconds)} ‡§∏‡§Æ‡§Ø‡§Æ‡§æ ‡§™‡§ú‡§≤ ‡§∏‡§≤‡•ç‡§≠ ‡§ó‡§∞‡•á‡§Ç! üéÆ`,
                    url: window.location.href
                }).catch(console.error);
            } else {
                const text = `‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ - ‡§∏‡§Æ‡§Ø ${formatTime(seconds)}! ${moves} ‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§™‡§ú‡§≤ ‡§∏‡§≤‡•ç‡§≠! üéâ\n${window.location.href}`;
                navigator.clipboard.writeText(text).then(() => alert('‡§ü‡§ø‡§ï‡§ü‡§ï‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø ‡§≤‡§ø‡§ô‡•ç‡§ï ‡§ï‡§™‡•Ä ‡§≠‡§Ø‡•ã!')).catch(() => alert('‡§ï‡§™‡•Ä ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§è‡§®‡•§'));
            }
        }

        function shareToFacebook(e) {
            e.preventDefault();
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent('‡§Æ‡•à‡§≤‡•á ‡§™‡§ú‡§≤ ‡§Æ‡•á‡§®‡§ø‡§Ø‡§æ‡§Æ‡§æ ' + formatTime(seconds) + ' ‡§∏‡§Æ‡§Ø‡§Æ‡§æ ‡§∞ ' + moves + ' ‡§ö‡§æ‡§≤‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§™‡§ú‡§≤ ‡§∏‡§≤‡•ç‡§≠ ‡§ó‡§∞‡•á‡§Ç! üéâ')}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        // Event listeners
        playBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', () => {
            restartGame();
            startGame();
        });
        screenshotBtn.addEventListener('click', takeScreenshot);
        tiktokShare.addEventListener('click', shareToTikTok);
        facebookShare.addEventListener('click', shareToFacebook);
        document.addEventListener('keydown', handleKeyboardInput);

        // Touch support
        let touchStartX = 0, touchStartY = 0, touchTile = null;
        gameArea.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            touchTile = e.target.closest('.tile');
        }, { passive: false });

        gameArea.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (!gameActive || !touchTile || touchTile.classList.contains('empty')) return;
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const minSwipeDistance = 20;

            const number = parseInt(touchTile.dataset.number);
            const tileIndex = board.indexOf(number);
            const emptyIndex = getEmptyPosition();
            const tileRow = Math.floor(tileIndex / gridSize);
            const tileCol = tileIndex % gridSize;
            const emptyRow = Math.floor(emptyIndex / gridSize);
            const emptyCol = emptyIndex % gridSize;

            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0 && tileCol > 0 && tileRow === emptyRow && tileCol - 1 === emptyCol) {
                    moveTile(tileIndex);
                } else if (deltaX < 0 && tileCol < gridSize - 1 && tileRow === emptyRow && tileCol + 1 === emptyCol) {
                    moveTile(tileIndex);
                } else {
                    mistakes++;
                    mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
                }
            } else if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > minSwipeDistance) {
                if (deltaY > 0 && tileRow > 0 && tileCol === emptyCol && tileRow - 1 === emptyRow) {
                    moveTile(tileIndex);
                } else if (deltaY < 0 && tileRow < gridSize - 1 && tileCol === emptyCol && tileRow + 1 === emptyRow) {
                    moveTile(tileIndex);
                } else {
                    mistakes++;
                    mistakesDisplay.textContent = `‡§ó‡§≤‡•ç‡§§‡•Ä‡§π‡§∞‡•Ç: ${mistakes}`;
                }
            } else if (Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10) {
                // Handle tap
                moveTile(tileIndex);
            }
        }, { passive: false });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            startScreen.style.display = 'flex';
            gameOverDisplay.style.display = 'none';
            initGame();
        });

        // Cleanup
        window.addEventListener('beforeunload', () => {
            gameActive = false;
            clearInterval(timerInterval);
        });
    </script>
</body>
</html>
